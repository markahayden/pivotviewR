/*! pivotviewer v2.0.0 | Built 2016-08-10 | Licence https://github.com/RogerNoble/html5pivotviewer/blob/develop/LICENSE */
var global={},PivotViewer=PivotViewer||{};PivotViewer.Version="@VERSION@",PivotViewer.Models={},PivotViewer.Models.Loaders={},PivotViewer.Utils={},PivotViewer.Views={};var Debug=Debug||{};!function(a){var b={};a.publish=function(c,d){b[c]&&a.each(b[c],function(){this.apply(a,d||[])})},a.subscribe=function(a,c){return b[a]||(b[a]=[]),b[a].push(c),[a,c]},a.unsubscribe=function(c){var d=c[0];b[d]&&a.each(b[d],function(a){this==c[1]&&b[d].splice(a,1)})}}(jQuery),Debug.Log=function(a){window.console&&window.console.log&&"undefined"!=typeof debug&&1==debug&&window.console.log(a)},Number.prototype.formatNumber=function(a){var b=this;if(""==a)return b;var c=a.substr(0,1),d=parseInt(a.substr(1,1));return"n"==c?b.toFixed(d):"p"==c?b.toFixed(d)+"%":"d"==c?"$"+b.formatMoney(d):b},Number.prototype.formatMoney=function(a,b,c){var d=this,a=isNaN(a=Math.abs(a))?2:a,b=void 0==b?".":b,c=void 0==c?",":c,e=d<0?"-":"",f=parseInt(d=Math.abs(+d||0).toFixed(a))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+c:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+c)+(a?b+Math.abs(d-f).toFixed(a).slice(2):"")},window.requestAnimFrame=function(a){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),PivotViewer.Utils.EscapeMetaChars=function(a){return a.replace(/\|/gi,"\\|").replace(/\//gi,"\\/").replace(/'/gi,"\\'").replace(/,/gi,"\\,").replace(/:/gi,"\\:").replace(/\(/gi,"\\(").replace(/\)/gi,"\\)").replace(/\+/gi,"\\+").replace(/\+/gi,"\\-").replace(/\+/gi,"\\_").replace(/\+/gi,"\\%")},PivotViewer.Utils.EscapeItemId=function(a){return a.replace(/\s+/gi,"|").replace(/'/gi,"").replace(/\(/gi,"").replace(/\)/gi,"").replace(/\./gi,"")},PivotViewer.Utils.HtmlSpecialChars=function(a){return jQuery("<div />").text(a).html()},PivotViewer.Utils.Now=function(){return Date.now?Date.now():(new Date).getTime()},PivotViewer.Utils.Min=function(a){for(var b=1e6,c=0,d=a.length;c<d;c++)b=b>a[c]?a[c]:b;return b},PivotViewer.Utils.Max=function(a){for(var b=-1e6,c=0,d=a.length;c<d;c++)b=b<a[c]?a[c]:b;return b},PivotViewer.Utils.Histogram=function(a){if(!a instanceof Array)return null;var b=PivotViewer.Utils.Min(a),c=PivotViewer.Utils.Max(a),d=2*(Math.floor(Math.pow(2*a.length,1/3))+1);d>10&&(d=10);for(var e=(c+1-(b-1))/d,f=[],g=0;g<d;g++){var h=b+g*e,i=b+(g+1)*e;f.push([]);for(var j=0,k=a.length;j<k;j++)h<=a[j]&&i>a[j]&&f[g].push(a[j])}return{Histogram:f,Min:b,Max:c,BinCount:d}},function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;Object.subClass=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.constructor=d,d.subClass=arguments.callee,d}}(),PivotViewer.Models.Collection=Object.subClass({init:function(){this.CollectionName="",this.BrandImage="",this.FacetCategories=[],this.Items=[],this.CollectionBase="",this.CollectionBaseNoProxy="",this.ImageBase="",this.CopyrightName="",this.CopyrightHref="",this.MaxRelatedLinks=0},GetItemById:function(a){for(var b=0;b<this.Items.length;b++)if(this.Items[b].Id==a)return this.Items[b];return null},GetFacetCategoryByName:function(a){for(var b=0;b<this.FacetCategories.length;b++)if(this.FacetCategories[b].Name==a)return this.FacetCategories[b];return null},GetUniqueImages:function(){for(var a=[],b=0;b<this.Items.length;b++)a.indexOf(this.Items[b].Img)==-1&&a.push(this.Items[b].Img);return a}}),PivotViewer.Models.FacetCategory=Object.subClass({init:function(a,b,c,d,e,f,g){this.Name=a,this.Format=b,this.Type=null!=c&&void 0!=c?c:PivotViewer.Models.FacetType.String,this.IsFilterVisible=null==d||void 0==d||d,this.IsMetaDataVisible=null==e||void 0==e||e,this.IsWordWheelVisible=null==f||void 0==f||f,this.CustomSort,this.decadeBuckets=[],this.yearBuckets=[],this.monthBuckets=[],this.dayBuckets=[],this.hourBuckets=[],this.minuteBuckets=[],this.secondBuckets=[]}}),PivotViewer.Models.FacetCategorySort=Object.subClass({init:function(a){this.Name=a,this.SortValues=[]}}),PivotViewer.Models.Item=Object.subClass({init:function(a,b,c,d){this.Img=a,this.Id=b,this.Href=c,this.Name=d,this.Description,this.Facets=[],this.Links=[]}}),PivotViewer.Models.ItemLink=Object.subClass({init:function(a,b){this.Name=a,this.Href=b}}),PivotViewer.Models.Facet=Object.subClass({init:function(a,b){this.Name=a,void 0===b?this.FacetValues=[]:this.FacetValues=b},AddFacetValue:function(a){this.FacetValues.push(a)}}),PivotViewer.Models.FacetValue=Object.subClass({init:function(a){this.Value=a,this.Href=""}}),PivotViewer.Models.DateTimeInfo=Object.subClass({init:function(a,b){this.Name=a,this.StartDate=b,this.Items=[]}}),PivotViewer.Models.FacetType={String:"String",LongString:"LongString",Number:"Number",DateTime:"DateTime",Link:"Link"},PivotViewer.Models.Loaders.ICollectionLoader=Object.subClass({init:function(){},LoadCollection:function(a){if(!a instanceof PivotViewer.Models.Collection)throw"collection not an instance of PivotViewer.Models.Collection."}}),PivotViewer.Models.Loaders.JSONLoader=PivotViewer.Models.Loaders.ICollectionLoader.subClass({init:function(a,b){this.JSONNoProxy=a,b?this.JSON=b+a:this.JSON=a},LoadCollection:function(a){var a=a;this._super(a),a.CollectionBaseNoProxy="",a.CollectionBase="";var b=this.JSON;if(Debug.Log("JSON loaded"),void 0==b.FacetCategories||void 0==b.Items){$(".pv-loading").remove();var c="";c+="Error parsing JSON Collection<br>",c+="<br>Pivot Viewer cannot continue until this problem is resolved<br>",$(".pv-wrapper").append('<div id="pv-parse-error" class="pv-modal-dialog"><div><a href="#pv-modal-dialog-close" title="Close" class="pv-modal-dialog-close">X</a><h2>HTML5 PivotViewer</h2><p>'+c+"</p></div></div>");setTimeout(function(){window.open("#pv-parse-error","_self")},1e3);throw"Error parsing JSON Collection"}void 0!=b.CollectionName&&(a.CollectionName=b.CollectionName),void 0!=b.BrandImage&&(a.BrandImage=b.BrandImage);for(var d=0;d<b.FacetCategories.length;d++){var e=new PivotViewer.Models.FacetCategory(b.FacetCategories[d].Name,b.FacetCategories[d].Format,b.FacetCategories[d].Type,void 0==b.FacetCategories[d].IsFilterVisible||"true"==b.FacetCategories[d].IsFilterVisible.toLowerCase(),void 0==b.FacetCategories[d].IsMetadataVisible||"true"==b.FacetCategories[d].IsMetadataVisible.toLowerCase(),void 0==b.FacetCategories[d].IsWordWheelVisible||"true"==b.FacetCategories[d].IsWordWheelVisible.toLowerCase());if(void 0!=b.FacetCategories[d].SortOrder){var f=new PivotViewer.Models.FacetCategorySort(b.FacetCategories[d].SortOrder.Name);for(j=0;j<b.FacetCategories[d].SortValues.Value.length;J++)f.Values.push(b.FacetCategories[d].SortValues.Value[j]);e.CustomSort=f}a.FacetCategories.push(e)}if(void 0!=b.ImgBase&&(a.ImageBase=b.ImgBase),0==b.Items.length){$(".pv-loading").remove();var c="";c+="There are no items in the JSON Collection<br><br>",$(".pv-wrapper").append('<div id="pv-empty-collection-error" class="pv-modal-dialog"><div><a href="#pv-modal-dialog-close" title="Close" class="pv-modal-dialog-close">X</a><h2>HTML5 PivotViewer</h2><p>'+c+"</p></div></div>");setTimeout(function(){window.open("#pv-empty-collection-error","_self")},1e3)}else for(var d=0;d<b.Items.length;d++){var g=new PivotViewer.Models.Item(b.Items[d].Img.replace("#",""),b.Items[d].Id,b.Items[d].Href,b.Items[d].Name);for(g.Description=b.Items[d].Description,k=0;k<b.FacetCategories.length;k++){var h=[];if("Number"==b.FacetCategories[k].Type){var i=new PivotViewer.Models.FacetValue(parseFloat(b.Items[d][b.FacetCategories[k].Name]));h.push(i)}else{var l=b.Items[d][b.FacetCategories[k].Name],m=l.split("|");for(n=0;n<m.length;n++){var i=new PivotViewer.Models.FacetValue(m[n]);h.push(i)}}var o=new PivotViewer.Models.Facet(b.FacetCategories[k].Name,h);g.Facets.push(o)}void 0!=b.Items[d].Extension&&void 0!=b.Items[d].Extension.Related&&(g.Links=b.Items[d].Extension.Related.Link),a.Items.push(g)}void 0!=b.Copyright&&(a.CopyrightName=b.Copyright.Name,a.CopyrightHref=b.Copyright.Href),b.Items.length>0&&$.publish("/PivotViewer/Models/Collection/Loaded",null)}}),PivotViewer.Views.IPivotViewerView=Object.subClass({init:function(){this.isActive=!1,this.init=!0,this.selected="",this.tiles=[]},Setup:function(a,b,c,d,e){},Filter:function(a,b,c){},GetUI:function(){return""},GetButtonImage:function(){return""},GetButtonImageSelected:function(){return""},GetViewName:function(){return""},Activate:function(){this.isActive=!0},Deactivate:function(){this.isActive=!1}}),PivotViewer.IPivotViewerViewport=Object.subClass({init:function(){},GetViewportWidth:function(){},GetViewportHeight:function(){},GetOffsetX:function(){},GetOffsetY:function(){}}),PivotViewer.Views.TileBasedView=PivotViewer.Views.IPivotViewerView.subClass({OffsetTiles:function(a,b){for(var c=0;c<this.tiles.length;c++){var d=$.inArray(this.tiles[c].facetItem.Id,this.currentFilter);d>=0&&(this.tiles[c]._locations[0].destinationx+=a,this.tiles[c]._locations[0].destinationy+=b)}},SetInitialTiles:function(a,b,c){for(var d=b/2,e=c/2,f=0;f<a.length;f++)a[f]._locations[0].x=d,a[f]._locations[0].y=e,a[f].velocityx=0,a[f].velocityy=0,a[f]._locations[0].startx=d,a[f]._locations[0].starty=e,a[f]._locations[0].destinationx=0,a[f]._locations[0].destinationy=0,a[f].width=1,a[f].height=1},GetRowsAndColumns:function(a,b,c,d){var e=.7,f=c*(d-Math.pow(e,2)),g=(b+a*c)*e,h=-1*(b*a),i=(-1*g+Math.sqrt(Math.pow(g,2)-4*f*h))/(2*f),j=Math.floor(i*c),k=Math.ceil(b/j),l=Math.floor(a/i),m=a-l*i;return{Rows:k,Columns:l,TileMaxWidth:i,TileHeight:j,PaddingX:m}},SetOuterTileDestination:function(a,b,c){var d=c._locations[0].x-a/2,e=c._locations[0].y-b/2,f=Math.atan2(e,d);c._locations[0].destinationx=a*Math.cos(f)+a/2,c._locations[0].destinationy=b*Math.sin(f)+b/2},SortBy:function(a,b,c,d){var e=function(b,d){if(c)for(var e=b.facetItem.Facets.length-1;e>-1;e-=1)if(b.facetItem.Facets[e].Name==a&&b.facetItem.Facets[e].FacetValues.length>0){if($.isNumeric(b.facetItem.Facets[e].FacetValues[0].Value))return c(b.facetItem.Facets[e].FacetValues[0].Value);for(var f=0;f<b.facetItem.Facets[e].FacetValues.length;f++)if(d.length>0)for(var g=0;g<d.length;g++)if(d[g].facet==a)for(var h=0;h<d[g].facetValue.length;h++)if(b.facetItem.Facets[e].FacetValues[f].Value==d[g].facetValue[h])return c(b.facetItem.Facets[e].FacetValues[f].Value);return c(b.facetItem.Facets[e].FacetValues[0].Value)}return null};return function(a,c){var f=e(a,d),g=e(c,d);return(f<g?-1:f>g?1:0)*[1,-1][+!!b]}}}),PivotViewer.Views.DataView=PivotViewer.Views.IPivotViewerView.subClass({init:function(){this._super()},Setup:function(a,b,c,d,e){},Filter:function(a,b,c){},GetUI:function(){return""},GetButtonImage:function(){return""},GetButtonImageSelected:function(){return""},GetViewName:function(){return"Grid View"}}),PivotViewer.Views.GraphView=PivotViewer.Views.TileBasedView.subClass({init:function(){this._super();var a=this;this.buckets=[],this.Scale=1,this.canvasHeightUIAdjusted=0,this.titleSpace=50,this.spacing=2,this.dontZoom=!1,$.subscribe("/PivotViewer/Views/Canvas/Click",function(b){if(a.isActive){for(var c=null,d=null,e=null,f=0;f<a.tiles.length;f++){var g=a.tiles[f].Contains(b.x,b.y);g>=0?(d=a.tiles[f],c=a.tiles[f].facetItem.Id,e=g):a.tiles[f].Selected(!1)}a.handleSelection(c,d,b.x,e)}}),$.subscribe("/PivotViewer/Views/Canvas/Hover",function(b){if(a.isActive){$(".pv-viewarea-graphview-overlay-bucket").removeClass("graphview-bucket-hover");var c=Math.floor((b.x-a.offsetX)/a.columnWidth),d=$("#pv-viewarea-graphview-overlay-bucket-"+c);d.addClass("graphview-bucket-hover");for(var e=0;e<a.tiles.length;e++){var f=a.tiles[e].Contains(b.x,b.y);f>=0?(a.tiles[e].Selected(!0),a.tiles[e].selectedLoc=f):a.tiles[e].Selected(!1)}}}),$.subscribe("/PivotViewer/Views/Canvas/Zoom",function(b){if(a.isActive){if(a.dontZoom)return void(a.dontZoom=!1);var c=a.Scale;a.currentWidth,a.currentHeight,void 0!=b.scale?0:1e3;void 0!=b.scale?b.scale>=1?a.Scale+=b.scale-1:(a.Scale-=b.scale,a.Scale=a.Scale<1?1:a.Scale):void 0!=b.delta&&(a.Scale=0==b.delta?1:a.Scale+b.delta-1),NaN==a.Scale&&(a.Scale=1);var d=a.viewport.GetViewportWidth()-a.viewport.GetOffsetX(),e=a.viewport.GetViewportHeight()-a.viewport.GetOffsetY(),f=d*a.Scale,g=e*a.Scale;if(f<d||1==a.Scale)a.currentOffsetX=a.viewport.GetOffsetX(),a.currentOffsetY=a.viewport.GetOffsetY(),a.currentWidth=d,a.currentHeight=e,a.canvasHeightUIAdjusted=e-a.titleSpace,a.columnWidth=d/a.buckets.length,$(".pv-viewarea-graphview-overlay div").fadeIn("slow"),a.Scale=1,a.dontZoom=!0,$(".pv-toolbarpanel-zoomslider").slider("option","value",0);else{var h=(b.x-a.currentOffsetX)/c*a.Scale,i=(b.y-a.currentOffsetY)/c*a.Scale;a.currentOffsetX=b.x-h,a.currentOffsetY=b.y-i,a.currentWidth=f,a.currentHeight=g,a.canvasHeightUIAdjusted=g-a.titleSpace*a.Scale,a.columnWidth=f/a.buckets.length,$(".pv-viewarea-graphview-overlay div").fadeOut("slow")}if(a.rowscols=a.GetRowsAndColumns(a.columnWidth-4*a.spacing,a.canvasHeightUIAdjusted-4*a.spacing,a.maxRatio,a.bigCount),a.rowscols.TileHeight<10&&(a.rowscols.TileHeight=10),a.SetVisibleTileGraphPositions(a.rowscols,a.currentOffsetX+2*a.spacing,a.currentOffsetY-2*a.spacing,!0,!0),1==a.Scale&&1!=c){for(var j=0;j<a.tiles.length;j++)a.tiles[j].Selected(!1),a.tiles[j].selectedLoc=0;a.selected="",$.publish("/PivotViewer/Views/Item/Selected",[{id:a.selected,bkt:0}])}}}),$.subscribe("/PivotViewer/Views/Canvas/Drag",function(b){if(a.isActive){var c=b.x,d=b.y,e=!1,f=!1;a.currentOffsetX+=c,a.currentOffsetY+=d,c>0&&a.currentOffsetX>a.viewport.GetOffsetX()&&(a.currentOffsetX-=c,e=!0),d>0&&a.currentOffsetY+a.canvasHeightUIAdjusted>a.currentHeight+a.viewport.GetOffsetY()&&(a.currentOffsetY-=d,f=!0),a.currentOffsetX<a.viewport.GetOffsetX()&&a.currentWidth==a.viewport.GetViewportWidth()&&(a.currentOffsetX-=c,e=!0),c<0&&a.currentOffsetX<-1*(a.currentWidth-a.viewport.GetViewportWidth())&&(a.currentOffsetX-=c,e=!0),a.currentOffsetY<a.viewport.GetOffsetY()&&a.currentHeight==a.viewport.GetViewportHeight()&&(a.currentOffsetY-=d,f=!0),d<0&&a.currentOffsetY-a.viewport.GetOffsetY()<-1*(a.currentHeight-a.viewport.GetViewportHeight())&&(a.currentOffsetY-=d,f=!0),e&&f||(e?a.OffsetTiles(0,d):f?a.OffsetTiles(c,0):a.OffsetTiles(c,d))}})},Setup:function(a,b){this.viewport=a,this.maxRatio=b,this.currentWidth=this.viewport.GetViewportWidth(),this.currentHeight=this.viewport.GetViewportHeight(),this.currentOffsetX=this.viewport.GetOffsetX(),this.currentOffsetY=this.viewport.GetOffsetY(),this.rowscols=null,this.bigCount=0},Filter:function(a,b,c,d,e,f){var g=this;if(Modernizr.canvas){Debug.Log("Graph View Filtered: "+b.length),this.changingView=!1,e&&($(".pv-tableview-table").is(":visible")&&($(".pv-tableview-table").fadeOut(),$(".pv-toolbarpanel-zoomslider").fadeIn(),$(".pv-toolbarpanel-zoomcontrols").css("border-width","1px"),$(".pv-viewarea-canvas").fadeIn()),$(".pv-mapview-canvas").is(":visible")&&($(".pv-mapview-canvas").fadeOut(),$(".pv-toolbarpanel-zoomslider").fadeIn(),$(".pv-toolbarpanel-zoomcontrols").css("border-width","1px"),$(".pv-viewarea-canvas").fadeIn())),this.sortFacet=c,this.tiles=a,this.tiles=a.sort(this.SortBy(this.sortFacet,!1,function(a){return $.isNumeric(a)?a:a.toUpperCase()},d)),this.currentFilter=b,this.buckets=this.Bucketize(a,b,this.sortFacet,d),this.columnWidth=(this.viewport.GetViewportWidth()-this.viewport.GetOffsetX())/this.buckets.length,this.canvasHeightUIAdjusted=this.viewport.GetViewportHeight()-this.viewport.GetOffsetY()-this.titleSpace;var h=[];this.bigCount=0;for(var i=0;i<this.buckets.length;i++){var j=i%2==0?"graphview-bucket-dark":"graphview-bucket-light",k=Math.floor(this.columnWidth)-2*this.spacing,l=i*this.columnWidth+this.viewport.GetOffsetX()+this.spacing;h[i]="<div class='pv-viewarea-graphview-overlay-bucket "+j+"' id='pv-viewarea-graphview-overlay-bucket-"+i+"' style='width: "+k+"px; left:"+l+"px;'>",this.buckets[i].startRange==this.buckets[i].endRange?h[i]+="<div class='pv-viewarea-graphview-overlay-buckettitle'>"+this.buckets[i].startRange+"</div></div>":h[i]+="<div class='pv-viewarea-graphview-overlay-buckettitle'>"+this.buckets[i].startRange+"<br/>to<br/>"+this.buckets[i].endRange+"</div></div>",this.bigCount<this.buckets[i].Ids.length&&(this.bigCount=this.buckets[i].Ids.length)}var m=$(".pv-viewarea-graphview-overlay");$(".pv-viewarea-graphview-overlay div").fadeOut("slow",function(){$(this).remove()}),m.append(h.join("")),$(".pv-viewarea-graphview-overlay div").fadeIn("slow");for(var i=0;i<this.tiles.length;i++){this.tiles[i]._locations[0].startx=this.tiles[i]._locations[0].x,this.tiles[i]._locations[0].starty=this.tiles[i]._locations[0].y,this.tiles[i].startwidth=this.tiles[i].width,this.tiles[i].startheight=this.tiles[i].height;var n=$.inArray(this.tiles[i].facetItem.Id,b);n<0&&(this.SetOuterTileDestination(this.viewport.GetViewportWidth()+this.viewport.GetOffsetX()+this.spacing,this.canvasHeightUIAdjusted,this.tiles[i]),this.tiles[i].start=PivotViewer.Utils.Now(),this.tiles[i].end=this.tiles[i].start+1e3)}g.maxRatio=g.tiles[0]._controller.GetRatio(g.tiles[0].facetItem.Img);for(var i=0;i<g.tiles.length;i++){var n=$.inArray(g.tiles[i].facetItem.Id,b);n>=0&&g.tiles[i]._controller.GetRatio(g.tiles[i].facetItem.Img)<g.maxRatio&&(g.maxRatio=g.tiles[i]._controller.GetRatio(g.tiles[i].facetItem.Img))}var o=b.length==this.tiles.length?0:500;setTimeout(function(){var a=$(".pv-toolbarpanel-zoomslider").slider("option","value");a>0&&(g.selected=selectedItem="",g.currentOffsetX=g.viewport.GetOffsetX(),g.currentOffsetY=g.viewport.GetOffsetY(),$(".pv-toolbarpanel-zoomslider").slider("option","value",0)),g.rowscols=g.GetRowsAndColumns(g.columnWidth-4*g.spacing,g.canvasHeightUIAdjusted-4*g.spacing,g.maxRatio,g.bigCount),g.rowscols.TileHeight<10&&(g.rowscols.TileHeight=10);for(var b=0;b<g.tiles.length;b++)g.tiles[b].origwidth=g.rowscols.TileHeight/g.tiles[b]._controller.GetRatio(g.tiles[b].facetItem.Img),g.tiles[b].origheight=g.rowscols.TileHeight;g.SetVisibleTileGraphPositions(g.rowscols,g.viewport.GetOffsetX()+2*g.spacing,g.viewport.GetOffsetY()-2*g.spacing,!1,!1)},o),this.init=!1}},GetUI:function(){return Modernizr.canvas?"<div class='pv-viewarea-graphview-overlay'></div>":"<div class='pv-viewpanel-unabletodisplay'><h2>Unfortunately this view is unavailable as your browser does not support this functionality.</h2>Please try again with one of the following supported browsers: IE 9+, Chrome 4+, Firefox 2+, Safari 3.1+, iOS Safari 3.2+, Opera 9+<br/><a href='http://caniuse.com/#feat=canvas'>http://caniuse.com/#feat=canvas</a></div>"},GetButtonImage:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAUCAYAAABxnDbHAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjEwMPRyoQAAAQdJREFUSEtj+P//PwO9Md0tBHlwhFtaM3nB/6jydjBeuHEXMESoG+9YgxdmIYiu6J9LsqU37j36f+nmXZz6iLYUZMjqnQfBGGQoLt93zlsJD6W8jqlY1RG0tLxvDlhjRtNEuGFFXTNwWgpSjxxS2BxHtKXJ9X1ww3Lbp4AtvXL7/v9VOw6A8cUbd8BiNLc0v2Ma3CGgkKDI0siytv8wDAvepLpeuBjMpyAapg4kD7MUWT/RwTsyLS3rnQ0ONuTgzWmbDBYD0ejBC1JPcfDSzdKqifPgrp27dhvYVy0zl8LFpizbCBbrW7gGLtY5dwVYbOaqLXCx+qkLiS8cqF3Wops3wqs2WgcvAG0HdPD7CPDvAAAAAElFTkSuQmCC"},GetButtonImageSelected:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAUCAYAAABxnDbHAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwgAADsIBFShKgAAAABp0RVh0U29mdHdhcmUAUGFpbnQuTkVUIHYzLjUuMTAw9HKhAAABFUlEQVRIS2NYfuHR/znnntANg+xjAFl47cZNumGQfSPc0prJC/5HlbeD8cKNu6ga9DiDF2YhiK7on0uypTfuPfp/6eZdrPpIshRkyOqdB8EYZCiuxNc5byU8lPI6pmKoI8rS8r45YI0ZTRPhhhV1zcBpKUg9ckihO44kS5Pr++CG5bZPAVt65fb9/6t2HADjizfugMVobml+xzS4Q0AhQZGlkWVt/2EYFrxJdb1wMZhPQTRMHUgeZimyfqKDd2RaWtY7GxxsyMGb0zYZLAai0YMXpJ7i4KWbpVUT58FdO3ftNrCvWmYuhYtNWbYRLNa3cA1crHPuCrDYzFVb4GL1UxcSXzjQsqobYVXb/PP0a6qAghZkHwCfBz/h7LsUxgAAAABJRU5ErkJggg=="},GetViewName:function(){return"Graph View"},GetSortedFilter:function(){var a=[];for(i=0;i<this.buckets.length;i++)for(j=0;j<this.buckets[i].Ids.length;j++){var b=new Object;b.Id=this.buckets[i].Ids[j],b.Bucket=i,a.push(b)}return a},SetVisibleTileGraphPositions:function(a,b,c,d,e){var f=e&&this.rowscols?this.rowscols.Columns:a.Columns;e||(this.rowscols=a);for(var g=0;g<this.tiles.length;g++)for(this.tiles[g].firstFilterItemDone=!1;this.tiles[g]._locations.length>1;)this.tiles[g]._locations.pop();for(var h=0;h<this.buckets.length;h++)for(var i=0,j=0,k=0,l=this.tiles.length;k<l;k++)$.inArray(this.tiles[k].facetItem.Id,this.buckets[h].Ids)>=0&&(this.tiles[k].firstFilterItemDone?(tileLocation=new PivotViewer.Views.TileLocation,tileLocation.startx=this.tiles[k]._locations[0].startx,tileLocation.starty=this.tiles[k]._locations[0].starty,tileLocation.x=this.tiles[k]._locations[0].x,tileLocation.y=this.tiles[k]._locations[0].y,tileLocation.destinationx=h*this.columnWidth+i*a.TileMaxWidth+b,tileLocation.destinationy=this.canvasHeightUIAdjusted-a.TileHeight-j*a.TileHeight+c,this.tiles[k]._locations.push(tileLocation)):(d&&(this.tiles[k]._locations[0].startx=this.tiles[k]._locations[0].x,this.tiles[k]._locations[0].starty=this.tiles[k]._locations[0].y,this.tiles[k].startwidth=this.tiles[k].width,this.tiles[k].startheight=this.tiles[k].height),this.tiles[k].destinationwidth=a.TileMaxWidth,this.tiles[k].destinationheight=a.TileHeight,this.tiles[k]._locations[0].destinationx=h*this.columnWidth+i*a.TileMaxWidth+b,this.tiles[k]._locations[0].destinationy=this.canvasHeightUIAdjusted-a.TileHeight-j*a.TileHeight+c,this.tiles[k].start=PivotViewer.Utils.Now(),this.tiles[k].end=this.tiles[k].start+1e3,this.tiles[k].firstFilterItemDone=!0),i==f-1?(i=0,j++):i++)},Bucketize:function(a,b,c,d){for(var e=[],f=0;f<a.length;f++)if($.inArray(a[f].facetItem.Id,b)>=0){for(var g=!1,h=0;h<a[f].facetItem.Facets.length;h++)if(a[f].facetItem.Facets[h].Name==c&&a[f].facetItem.Facets[h].FacetValues.length>0)for(var i=0;i<a[f].facetItem.Facets[h].FacetValues.length;i++){for(var j=a[f].facetItem.Facets[h].FacetValues[i].Value,k=!1,l=0;l<e.length;l++)e[l].startRange==j&&($.inArray(a[f].facetItem.Id,e[l].Ids)<0&&e[l].Ids.push(a[f].facetItem.Id),k=!0);k||e.push({startRange:j,endRange:j,Ids:[a[f].facetItem.Id],Values:[j]}),g=!0}if(!g){for(var j="(no info)",k=!1,l=0;l<e.length;l++)e[l].startRange==j&&(e[l].Ids.push(a[f].facetItem.Id),e[l].Values.push(j),k=!0);k||e.push({startRange:j,endRange:j,Ids:[a[f].facetItem.Id],Values:[j]})}}if(d.length>0){for(var m,n=0;n<d.length;n++)if(d[n].facet==c){m=n;break}if(void 0!=m&&m>=0){for(var o=[],p=d[m].facetValue,q=0;q<e.length;q++){var r=$.inArray(e[q].startRange,p);r>=0&&o.push(e[q])}e=o}}for(var s=0;e.length>8;)if(s<e.length-1){e[s].endRange=e[s+1].endRange;for(var f=0;f<e[s+1].Ids.length;f++)$.inArray(e[s+1].Ids[f],e[s].Ids)<0&&e[s].Ids.push(e[s+1].Ids[f]),$.inArray(e[s+1].endRange,e[s].Values)<0&&e[s].Values.push(e[s+1].endRange);e.splice(s+1,1),s++}else s=0;return e},GetSelectedCol:function(a,b){var c=this,d=0;if(null==b)d=a.selectedLoc;else for(i=0;i<b;i++)$.inArray(a.facetItem.Id,this.buckets[i].Ids)>0&&d++;var e=c.rowscols.PaddingX,f=c.rowscols.Columns,g=c.rowscols.TileMaxWidth,h=g*f+e+4*c.spacing,j=a._locations[d].x-c.currentOffsetX,k=Math.floor(j/h),l=Math.floor((j-k*h)/g),m=k*f+l;return m},GetSelectedRow:function(a,b){var c=this,d=0;if(null==b)d=a.selectedLoc;else for(i=0;i<b;i++)$.inArray(a.facetItem.Id,this.buckets[i].Ids)>0&&d++;var e=Math.round((c.canvasHeightUIAdjusted-(a._locations[d].y-c.currentOffsetY))/a.height);return e},CentreOnSelectedTile:function(a,b){var c=this,d=Math.floor(a/c.rowscols.Columns),e=(c.rowscols.PaddingX+4*c.spacing)*d,f=-(c.rowscols.TileMaxWidth*a)-e;c.currentOffsetX=f+(c.viewport.GetViewportWidth()-c.rowscols.TileMaxWidth)/2;var g=-c.canvasHeightUIAdjusted+2*c.spacing+c.rowscols.TileHeight*b;c.currentOffsetY=g+(c.viewport.GetViewportHeight()-c.rowscols.TileHeight)/2,c.SetVisibleTileGraphPositions(c.rowscols,c.currentOffsetX+2*c.spacing,c.currentOffsetY-2*c.spacing,!0,!0)},handleSelection:function(a,b,c,d){var e=this,f=0,g=0,h=!1,i=!1;if(null!=a&&null!=b&&(selectedX=b._locations[d].x,selectedY=b._locations[d].y),null!=a&&e.selected!=a&&""==e.selected){var j=$(".pv-toolbarpanel-zoomslider").slider("option","value");0!=j&&$(".pv-toolbarpanel-zoomslider").slider("option","value",0)}if(null!=a&&null!=b&&(b.Selected(!0),b.selectedLoc=d,h=!0,f=e.GetSelectedCol(b,null),selectedBar=Math.floor(f/e.rowscols.Columns),g=e.GetSelectedRow(b,null),tileHeight=b.height,tileWidth=b.height/b._controller.GetRatio(b.facetItem.Img),tileOrigHeight=b.origheight,tileOrigWidth=b.origwidth,canvasHeight=b.context.canvas.height-4*e.spacing,canvasWidth=b.context.canvas.width-($(".pv-filterpanel").width()+$(".pv-infopanel").width())-4*e.spacing),null==e.selected||""==e.selected||h||(i=!0),null!=a&&e.selected!=a?(tileHeight/canvasHeight>tileWidth/canvasWidth?origProportion=tileOrigHeight/canvasHeight:origProportion=tileOrigWidth/canvasWidth,this.currentOffsetY=this.viewport.GetOffsetY(),scale=Math.round(.75/origProportion*2),""==e.selected&&$(".pv-toolbarpanel-zoomslider").slider("option","value",scale),e.selected=a,e.CentreOnSelectedTile(f,g),$(".pv-viewarea-graphview-overlay div").fadeOut("slow")):(e.selected=a="",selectedBar=0,e.currentOffsetX=e.viewport.GetOffsetX(),e.currentOffsetY=e.viewport.GetOffsetY(),$(".pv-toolbarpanel-zoomslider").slider("option","value",0),$(".pv-viewarea-graphview-overlay div").fadeIn("slow")),$.publish("/PivotViewer/Views/Item/Selected",[{id:a,bkt:selectedBar}]),!h&&!i){var k=Math.floor((c-e.viewport.GetOffsetX())/e.columnWidth);$.publish("/PivotViewer/Views/Item/Filtered",[{Facet:e.sortFacet,Item:e.buckets[k].startRange,MaxRange:e.buckets[k].endRange,Values:e.buckets[k].Values,ClearFacetFilters:!0}])}},SetFacetCategories:function(a){this.categories=a.FacetCategories}}),PivotViewer.Views.GridView=PivotViewer.Views.TileBasedView.subClass({init:function(){this.Scale=1,this._super(),this.dontZoom=!1;var a=this;$.subscribe("/PivotViewer/Views/Canvas/Click",function(b){if(a.isActive){for(var c=null,d=null,e=0;e<a.tiles.length;e++){var f=a.tiles[e].Contains(b.x,b.y);f>=0?(d=a.tiles[e],c=a.tiles[e].facetItem.Id):a.tiles[e].Selected(!1)}a.handleSelection(c,d)}}),$.subscribe("/PivotViewer/Views/Canvas/Hover",function(b){if(a.isActive&&!(a.selected.length>0))for(var c=0;c<a.tiles.length;c++){var d=a.tiles[c].Contains(b.x,b.y);d>=0?a.tiles[c].Selected(!0):a.tiles[c].Selected(!1)}}),$.subscribe("/PivotViewer/Views/Canvas/Zoom",function(b){if(a.isActive){if(a.dontZoom)return void(a.dontZoom=!1);var c=a.Scale,d=(a.currentWidth,a.currentHeight,void 0!=b.scale?0:1e3);void 0!=b.scale?b.scale>=1?a.Scale+=b.scale-1:(a.Scale-=b.scale,a.Scale=a.Scale<1?1:a.Scale):void 0!=b.delta&&(a.Scale=0==b.delta?1:a.Scale+b.delta-1),NaN==a.Scale&&(a.Scale=1);var e=(a.viewport.GetViewportWidth()-a.viewport.GetOffsetX())*a.Scale,f=(a.viewport.GetViewportHeight()-a.viewport.GetOffsetY())*a.Scale;if(e<a.viewport.GetViewportWidth()||1==a.Scale)a.currentOffsetX=a.viewport.GetOffsetX(),a.currentOffsetY=a.viewport.GetOffsetY(),a.currentWidth=a.viewport.GetViewportWidth(),a.currentHeight=a.viewport.GetViewportHeight(),a.Scale=1,a.dontZoom=!0,$(".pv-toolbarpanel-zoomslider").slider("option","value",0);else{var g=(b.x-a.currentOffsetX)/c*a.Scale,h=(b.y-a.currentOffsetY)/c*a.Scale;a.currentOffsetX=b.x-g,a.currentOffsetY=b.y-h,a.currentWidth=e,a.currentHeight=f}var i=a.GetRowsAndColumns(a.currentWidth-a.viewport.GetOffsetX(),a.currentHeight-a.viewport.GetOffsetY(),a.maxRatio,a.currentFilter.length);if(a.SetVisibleTilePositions(i,a.currentFilter,a.currentOffsetX,a.currentOffsetY,!0,!0,d),1==a.Scale&&1!=c){for(var j=0;j<a.tiles.length;j++)a.tiles[j].Selected(!1);a.selected="",$.publish("/PivotViewer/Views/Item/Selected",[{id:a.selected,bkt:0}])}}}),$.subscribe("/PivotViewer/Views/Canvas/Drag",function(b){if(a.isActive){var c=b.x,d=b.y,e=!1,f=!1;a.currentOffsetX+=c,a.currentOffsetY+=d,c>0&&a.currentOffsetX>a.viewport.GetOffsetX()&&(a.currentOffsetX-=c,e=!0),d>0&&a.currentOffsetY>a.viewport.GetOffsetY()&&(a.currentOffsetY-=d,f=!0),a.currentOffsetX<a.viewport.GetOffsetX()&&a.currentWidth==a.viewport.GetViewportWidth()&&(a.currentOffsetX-=c,e=!0),c<0&&a.currentOffsetX<-1*(a.currentWidth-a.viewport.GetViewportWidth())&&(a.currentOffsetX-=c,e=!0),a.currentOffsetY<a.viewport.GetOffsetY()&&a.currentHeight==a.viewport.GetViewportHeight()&&(a.currentOffsetY-=d,f=!0),d<0&&a.currentOffsetY-a.viewport.GetOffsetY()<-1*(a.currentHeight-a.viewport.GetViewportHeight())&&(a.currentOffsetY-=d,f=!0),e&&f||(e?a.OffsetTiles(0,d):f?a.OffsetTiles(c,0):a.OffsetTiles(c,d))}})},Setup:function(a,b){this.viewport=a,this.maxRatio=b,this.currentWidth=this.viewport.GetViewportWidth(),this.currentHeight=this.viewport.GetViewportHeight(),this.currentOffsetX=this.viewport.GetOffsetX(),this.currentOffsetY=this.viewport.GetOffsetY()},Filter:function(a,b,c,d,e,f){var g=this,h=!1;if(Modernizr.canvas){Debug.Log("Grid View Filtered: "+b.length),this.changingView=!1,e&&($(".pv-tableview-table").is(":visible")&&(h=!0,$(".pv-tableview-table").fadeOut(),this.selected="",$(".pv-toolbarpanel-zoomslider").fadeIn(),$(".pv-toolbarpanel-zoomcontrols").css("border-width","1px"),$(".pv-viewarea-canvas").fadeIn(function(){$.publish("/PivotViewer/Views/ChangeTo/Grid",[{Item:f}])})),$(".pv-mapview-canvas").is(":visible")&&(h=!0,$(".pv-mapview-canvas").fadeOut(),this.selected="",$(".pv-toolbarpanel-zoomslider").fadeIn(),$(".pv-toolbarpanel-zoomcontrols").css("border-width","1px"),$(".pv-viewarea-canvas").fadeIn(function(){$.publish("/PivotViewer/Views/ChangeTo/Grid",[{Item:f}])}))),this.tiles=a,this.init&&this.SetInitialTiles(this.tiles,this.viewport.GetViewportWidth(),this.viewport.GetViewportHeight());for(var i=0;i<this.tiles.length;i++)for(;this.tiles[i]._locations.length>1;)this.tiles[i]._locations.pop();for(var j=0;j<this.tiles.length;j++)this.tiles[j].selectedLoc=0;if(this.tiles=this.tiles.sort(this.SortBy(c,!1,function(a){return $.isNumeric(a)?a:a.toUpperCase()},d)),this.currentFilter=b,!h||""==f){var k=0;Debug.Log("this.currentWidth: "+this.currentWidth+" this.width: "+this.viewport.GetViewportWidth());var l=$(".pv-toolbarpanel-zoomslider").slider("option","value");if(l>0){this.selected=selectedItem="",this.currentOffsetX=this.viewport.GetOffsetX(),this.currentOffsetY=this.viewport.GetOffsetY(),$(".pv-toolbarpanel-zoomslider").slider("option","value",0);for(var m=this.GetRowsAndColumns(this.currentWidth-this.viewport.GetOffsetX(),this.currentHeight-this.viewport.GetOffsetY(),this.maxRatio,this.tiles.length),n=[],j=0;j<this.tiles.length;j++)this.tiles[j].origwidth=m.TileHeight/this.tiles[j]._controller.GetRatio(this.tiles[j].facetItem.Img),this.tiles[j].origheight=m.TileHeight,n.push(this.tiles[j].facetItem.Id);this.SetVisibleTilePositions(m,n,this.currentOffsetX,this.currentOffsetY,!0,!1,1e3),k=1e3}setTimeout(function(){for(var a=0;a<g.tiles.length;a++){g.tiles[a]._locations[0].startx=g.tiles[a]._locations[0].x,g.tiles[a]._locations[0].starty=g.tiles[a]._locations[0].y,g.tiles[a].startwidth=g.tiles[a].width,g.tiles[a].startheight=g.tiles[a].height;var c=$.inArray(g.tiles[a].facetItem.Id,b);c<0&&(g.SetOuterTileDestination(g.viewport.GetViewportWidth(),g.viewport.GetViewportHeight(),g.tiles[a]),g.tiles[a].start=PivotViewer.Utils.Now(),g.tiles[a].end=g.tiles[a].start+1e3)}g.maxRatio=g.tiles[0]._controller.GetRatio(g.tiles[0].facetItem.Img);for(var a=0;a<g.tiles.length;a++){var c=$.inArray(g.tiles[a].facetItem.Id,b);c>=0&&g.tiles[a]._controller.GetRatio(g.tiles[a].facetItem.Img)<g.maxRatio&&(g.maxRatio=g.tiles[a]._controller.GetRatio(g.tiles[a].facetItem.Img))}var d=b.length==g.tiles.length?0:500;setTimeout(function(){for(var a=g.GetRowsAndColumns(g.viewport.GetViewportWidth()-g.viewport.GetOffsetX(),g.viewport.GetViewportHeight()-g.viewport.GetOffsetY(),g.maxRatio,g.currentFilter.length),b=0;b<g.tiles.length;b++)g.tiles[b].origwidth=a.TileHeight/g.tiles[b]._controller.GetRatio(g.tiles[b].facetItem.Img),
g.tiles[b].origheight=a.TileHeight;g.SetVisibleTilePositions(a,g.currentFilter,g.viewport.GetOffsetX(),g.viewport.GetOffsetY(),!1,!1,1e3)},d)},k)}this.init=!1}},GetUI:function(){return Modernizr.canvas?"":"<div class='pv-viewpanel-unabletodisplay'><h2>Unfortunately this view is unavailable as your browser does not support this functionality.</h2>Please try again with one of the following supported browsers: IE 9+, Chrome 4+, Firefox 2+, Safari 3.1+, iOS Safari 3.2+, Opera 9+<br/><a href='http://caniuse.com/#feat=canvas'>http://caniuse.com/#feat=canvas</a></div>"},GetButtonImage:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAUCAYAAABxnDbHAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjEwMPRyoQAAAO9JREFUSEtjYBgFIyIEWmYt+x9V3g7He06c+w/zeFnfbLh4XFXX/9NXbsDldhw5jaKva/4quBzBgEO2EMTuRtKMLrdgw064wSB16PIELYMpGPSWzl+/gzo+nbB4HUq87UWK07qpC+FyyfV9/89cuQm3FKQOFM+wkAKZQ3TwjhyF/YvW/o8sawPj2MrO/3uOn4UHU+2UBXC5pLpelOAFqQOph+kFmUN0qME0weiueSvhmtHlkBMSSB26PE0snbduO9xBQ8/SxumLUYJpx5FTcN+U9MxEie/jF67A5bYePIGir33OcuLjlOh4GFU4GEMAAPvjedTG/AQ0AAAAAElFTkSuQmCC"},GetButtonImageSelected:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAUCAYAAABxnDbHAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwgAADsIBFShKgAAAABp0RVh0U29mdHdhcmUAUGFpbnQuTkVUIHYzLjUuMTAw9HKhAAABDElEQVRIS2NYfuHR/znnntANg+xjAFl47cZNumGQfSPc0pZZy/5HlbfD8Z4T5+DBX9Y3Gy4eV9X1//SVG3C5HUdOo+jrmr8KI9pwBi+yhSB2N5JmdLkFG3bCDQapQ5dHTy9D19L563dQx6cTFq9Dibe9SHFaN3UhXC65vu//mSuI7AZSB4pnWBCDzCE6eGmZbwdXPu1ftPZ/ZFkbGMdWdv7fc/wsPJhqpyyAyyXV9aIEL0gdSD1ML8gcooMXpglGd81bCdeMLoeckEDq0OVpYum8ddvhDhp6ljZOX4wSTDuOnIL7pqRnJkp8H79wBS639eAJFH3tc5YTH6cjJ8vQ3Kfzz9OvqQIqjUD2AQB/81By9CGKDQAAAABJRU5ErkJggg=="},GetViewName:function(){return"Grid View"},SetVisibleTilePositions:function(a,b,c,d,e,f,g){var h=f&&this.rowscols?this.rowscols.Columns:a.Columns;f||(this.rowscols=a);for(var i=0,j=0,k=0;k<this.tiles.length;k++){var l=$.inArray(this.tiles[k].facetItem.Id,b);l>=0&&(e&&(this.tiles[k]._locations[0].startx=this.tiles[k]._locations[0].x,this.tiles[k]._locations[0].starty=this.tiles[k]._locations[0].y,this.tiles[k].startwidth=this.tiles[k].width,this.tiles[k].startheight=this.tiles[k].height),this.tiles[k].destinationwidth=a.TileMaxWidth,this.tiles[k].destinationheight=a.TileHeight,this.tiles[k]._locations[0].destinationx=i*a.TileMaxWidth+c,this.tiles[k]._locations[0].destinationy=j*a.TileHeight+d,this.tiles[k].start=PivotViewer.Utils.Now(),this.tiles[k].end=this.tiles[k].start+g,i==h-1?(i=0,j++):i++)}},GetSelectedCol:function(a){var b=this;return selectedCol=Math.round((a._locations[0].x-b.currentOffsetX)/a.width),selectedCol},GetSelectedRow:function(a){var b=this;return selectedRow=Math.round((a._locations[0].y-b.currentOffsetY)/a.height),selectedRow},CentreOnSelectedTile:function(a,b){for(var c,d=this,e=0;e<d.tiles.length;e++)if(d.tiles[e].IsSelected()){c=d.tiles[e];break}var f=d.GetRowsAndColumns(d.currentWidth-d.viewport.GetOffsetX(),d.currentHeight-d.viewport.GetOffsetY(),d.maxRatio,d.currentFilter.length);d.currentOffsetX=f.TileMaxWidth*a*-1+d.viewport.GetViewportWidth()/2-f.TileMaxWidth/2,d.currentOffsetY=f.TileHeight*b*-1+d.viewport.GetViewportHeight()/2-f.TileHeight/2,d.SetVisibleTilePositions(f,d.currentFilter,d.currentOffsetX,d.currentOffsetY,!0,!0,1e3)},handleSelection:function(a,b){var c=this,d=0,e=0;if(null!=a&&null!=b&&(d=Math.round((b._locations[0].x-c.currentOffsetX)/b.width),e=Math.round((b._locations[0].y-c.currentOffsetY)/b.height)),null!=a&&c.selected!=a&&""==c.selected&&$(".pv-toolbarpanel-zoomslider").slider("option","value",0),null!=a&&null!=b&&(b.Selected(!0),tileHeight=b.height,tileWidth=b.height/b._controller.GetRatio(b.facetItem.Img),tileOrigHeight=b.origheight,tileOrigWidth=b.origwidth,canvasHeight=b.context.canvas.height,canvasWidth=b.context.canvas.width-($(".pv-filterpanel").width()+$(".pv-infopanel").width())),null!=a&&c.selected!=a){if(tileHeight/canvasHeight>tileWidth/canvasWidth?origProportion=tileOrigHeight/canvasHeight:origProportion=tileOrigWidth/canvasWidth,scale=Math.round(.75/origProportion*2),""==c.selected){var f=$(".pv-toolbarpanel-zoomslider").slider("option","value");f=scale,$(".pv-toolbarpanel-zoomslider").slider("option","value",f)}c.selected=a,c.CentreOnSelectedTile(d,e)}else c.selected=a="",c.currentOffsetX=c.viewport.GetOffsetX(),c.currentOffsetY=c.viewport.GetOffsetY(),$(".pv-toolbarpanel-zoomslider").slider("option","value",0);$.publish("/PivotViewer/Views/Item/Selected",[{id:a,bkt:0}])}}),PivotViewer.Views.IImageController=Object.subClass({init:function(){},Setup:function(a){},GetImagesAtLevel:function(a,b){},Width:0,Height:0}),PivotViewer.Views.LoadImageSetHelper=Object.subClass({init:function(){this._images=[],this._loaded=!1},LoadImages:function(a){for(var b=this,c=0;c<a.length;c++){var d=new Image;d.src=a[c],d.onload=function(){b._loaded=!0},this._images.push(d)}},GetImages:function(){return this._images},IsLoaded:function(){return this._loaded}}),PivotViewer.Views.TableView=PivotViewer.Views.IPivotViewerView.subClass({init:function(){this._super()},Setup:function(a,b){this.viewport=a,this.currentWidth=this.viewport.GetViewportWidth(),this.currentHeight=this.viewport.GetViewportHeight(),this.currentOffsetX=this.viewport.GetOffsetX(),this.currentOffsetY=this.viewport.GetOffsetY()},Filter:function(a,b,c,d,e,f){Modernizr.canvas&&(Debug.Log("Table View Filtered: "+b.length),e&&($(".pv-viewarea-canvas").fadeOut(),$(".pv-mapview-canvas").fadeOut(),$(".pv-toolbarpanel-zoomslider").fadeOut(),$(".pv-toolbarpanel-zoomcontrols").css("border-width","0"),$(".pv-tableview-table").fadeIn(function(){f&&$.publish("/PivotViewer/Views/Item/Selected",[{id:f.Id,bkt:0}])})),this.tiles=a,this.currentFilter=b,this.selectedId="",this.sortReverseEntity=!0,this.sortReverseAttribute=!0,this.sortReverseValue=!0,this.CreateTable(b,this.selectedFacet),this.init=!1)},GetUI:function(){return Modernizr.canvas?"":"<div class='pv-viewpanel-unabletodisplay'><h2>Unfortunately this view is unavailable as your browser does not support this functionality.</h2>Please try again with one of the following supported browsers: IE 9+, Chrome 4+, Firefox 2+, Safari 3.1+, iOS Safari 3.2+, Opera 9+<br/><a href='http://caniuse.com/#feat=canvas'>http://caniuse.com/#feat=canvas</a></div>"},GetButtonImage:function(){return"data:image/png;base64,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"},GetButtonImageSelected:function(){return"data:image/png;base64,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"},GetViewName:function(){return"Table View"},CellClick:function(a,b){if(Debug.Log("CellClick"),"pv-key"==a){for(var c=b[0].textContent.trim(),d=-1,e=0;e<this.tiles.length;e++)if(this.tiles[e].facetItem.Name==c){d=this.tiles[e].facetItem.Id;break}d>=0&&d!=this.selectedId?(this.selectedId=d,$.publish("/PivotViewer/Views/Item/Selected",[{id:d,bkt:0}])):d>=0&&d==this.selectedId&&(this.selectedId="",$.publish("/PivotViewer/Views/Item/Selected",[{id:"",bkt:0}]))}else if("pv-facet"==a){var f=[];""==this.selectedId||null==this.selectedId?f=this.currentFilter:f[0]=this.selectedId,""==this.selectedFacet||null==this.selectedFacet?(this.selectedFacet=b[1].textContent.trim(),this.CreateTable(f,this.selectedFacet,this.sortKey)):(this.selectedFacet="",this.CreateTable(f,"")),$.publish("/PivotViewer/Views/Item/Updated",null)}else"pv-value"==a&&$.publish("/PivotViewer/Views/Item/Filtered",[{Facet:b[1].textContent.trim(),Item:b[2].textContent.trim(),Values:null,ClearFacetFilters:!0}])},CreateTable:function(a,b,c,d){var e=this;$(".pv-loading").fadeIn(function(){setTimeout(function(){e.CreateTableInner(a,b,c,d),$(".pv-loading").fadeOut()},0)})},CreateTableInner:function(a,b,c,d){var e=this,f=$("#pv-table"),g=!1,h=new Array;f.empty();var i,j;null!=b&&""!=b&&void 0!=typeof b||(g=!0),$(".pv-tableview-table").css("left",e.viewport.GetOffsetX()+"px").css("top",e.viewport.GetOffsetY()+"px"),i=d?"images/sort-up.png":"images/sort-down.png";var m="odd-row",n="<table id='pv-table-data' style='color:#484848;'><tr class='pv-tableview-heading'><th id='pv-key' class='tooltipcustom' title='Sort on item name'>Item";"pv-key"==c&&(n+=" <img style='position:relative;top:"+j+"' src='"+i+"'></img>"),n+="</th><th class='tooltipcustom' id='pv-facet' title='Sort on relation name'>Relation","pv-facet"==c&&(n+=" <img style='position:relative;top:"+j+"' src='"+i+"'></img>"),n+="</th><th id='pv-value' class='tooltipcustom' title='Sort on value'>Value","pv-value"==c&&(n+=" <img style='position:relative;top:"+j+"' src='"+i+"'></img>"),n+="</th></tr>";for(var o=0;o<a.length;o++)for(var p=0;p<this.tiles.length;p++)if(this.tiles[p].facetItem.Id==a[o]){var q=this.tiles[p].facetItem.Name;if(g||"Description"==b){var r;"pv-key"==c?r=q:"pv-facet"==c?r="Description":"pv-value"==c&&(r=this.tiles[p].facetItem.Description),this.tiles[p].facetItem.Description&&(this.tiles[p].facetItem.Href?h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipinter' title='Toggle item selection' style='color:#009933;cursor:pointer'>"+q+" <a href="+this.tiles[p].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' title='Follow the link' src='images/goout.gif'></img></a></a></td><td id='pv-facet' class='tooltipcustom' title='Show only this relation' style='color:#009933;cursor:pointer'>Description</td><td id='pv-value'>"+this.tiles[p].facetItem.Description+"</td></tr>"}):h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltip' title='Toggle item selection'>"+q+"</td><td id='pv-facet' class='tooltipcustom' title='Show only this relation' style='color:#009933;cursor:pointer'>Description</td><td id='pv-value'>"+this.tiles[p].facetItem.Description+"</td></tr>"}),m="even-row")}if(m="odd-row"==m?"even-row":"odd-row",g)for(k=0;k<this.tiles[p].facetItem.Facets.length;k++){var s=this.tiles[p].facetItem.Facets[k].Name;for(l=0;l<this.tiles[p].facetItem.Facets[k].FacetValues.length;l++){var r,t=this.tiles[p].facetItem.Facets[k].FacetValues[l].Value;"pv-key"==c?r=q:"pv-facet"==c?r=s:"pv-value"==c&&(r=t),this.IsFilterVisible(s)?this.tiles[p].facetItem.Href?this.IsUri(t)?h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipinter' title='Toggle item selection' style='color:#009933;cursor:pointer'>"+q+" <a href="+this.tiles[p].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'></img></a></td><td id='pv-facet' class='tooltipcustom'  title='Show only this relation' style='color:#009933;cursor:pointer'>"+s+"</td><td id='pv-value' class='tooltipinter' title='Filter on this value' style='color:#009933;cursor:pointer'>"+t+" <a href="+t+" target=\"_blank\"><img style='cursor:default;' id=pv-linkout' title='Follow the link' src='images/goout.gif'></img></a></td></tr>"}):h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipinter' title='Toggle item selection' style='color:#009933;cursor:pointer'>"+q+" <a href="+this.tiles[p].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'></img></a></td><td id='pv-facet' class='tooltipcustom'  title='Show only this relation' style='color:#009933;cursor:pointer'>"+s+"</td><td id='pv-value' class='tooltipinter' title='Filter on this value' style='color:#009933;cursor:pointer'>"+t+"</td></tr>"}):this.IsUri(t)?h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipcustom' title='Toggle item selection'>"+q+"</td><td id='pv-facet' class='tooltipcustom'  title='Show only this relation'> style='color:#009933;cursor:pointer'"+s+"</td><td id='pv-value' class='tooltipinter' title='Filter on this value' style='color:#009933;cursor:pointer'>"+t+" <a href="+t+" target=\"_blank\"><img style='cursor:default;' id=pv-linkout' title='Follow the link' src='images/goout.gif'></img></a></td></tr>"}):h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipcustom' title='Toggle item selection'>"+q+"</td><td id='pv-facet' class='tooltipcustom'  title='Show only this relation'> style='color:#009933;cursor:pointer'"+s+"</td><td id='pv-value' class='tooltipinter'  title='Filter on this value' style='color:#009933;cursor:pointer'>"+t+"</td></tr>"}):this.tiles[p].facetItem.Href?this.IsUri(t)?h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipinter' title='Toggle item selection' style='color:#009933;cursor:pointer'>"+q+" <a href="+this.tiles[p].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'></img></a></td><td id='pv-facet' class='tooltipcustom' title='Show only this relation'> style='color:#009933;cursor:pointer'"+s+"</td><td id='pv-value'><a href="+t+">"+t+"</a></td></tr>"}):h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipinter' title='Toggle item selection' style='color:#009933;cursor:pointer'>"+q+" <a href="+this.tiles[p].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'></img></a></td><td id='pv-facet' class='tooltipcustom' title='Show only this relation'> style='color:#009933;cursor:pointer'"+s+"</td><td id='pv-value'>"+t+"</td></tr>"}):this.IsUri(t)?h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipcustom' title='Select this value'>"+q+"</td><td id='pv-facet' class='tooltipcustom' title='Show only this relation'> style='color:#009933;cursor:pointer'"+s+"</td><td id='pv-value'><a href"+t+">"+t+"</a></td></tr>"}):h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipcustom' title='Select this value'>"+q+"</td><td id='pv-facet' class='tooltipcustom' title='Show only this relation'> style='color:#009933;cursor:pointer'"+s+"</td><td id='pv-value'>"+t+"</td></tr>"}),m="odd-row"==m?"even-row":"odd-row"}}else for(k=0;k<this.tiles[p].facetItem.Facets.length;k++){var s=this.tiles[p].facetItem.Facets[k].Name;if(s==b){for(l=0;l<this.tiles[p].facetItem.Facets[k].FacetValues.length;l++){var r,t=this.tiles[p].facetItem.Facets[k].FacetValues[l].Value;"pv-key"==c?r=q:"pv-facet"==c?r=s:"pv-value"==c&&(r=t),this.IsFilterVisible(s)?this.tiles[p].facetItem.Href?this.IsUri(t)?h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipinter' title='Toggle item selection' style='color:#009933;cursor:pointer'>"+q+" <a href="+this.tiles[p].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'></img></a></td><td id='pv-facet' class='tooltipcustom' title='Clear relation selection' style='color:#009933;cursor:pointer'>"+s+"</td><td id='pv-value' class='tooltipinter 'title='Filter on this value' style='color:#009933;cursor:pointer'>"+t+" <a href="+t+" target=\"_blank\"><img style='cursor:default;' id=pv-linkout' title='Follow the link' src='images/goout.gif'></img></a></td></tr>"}):h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipinter' title='Toggle item selection' style='color:#009933;cursor:pointer'>"+q+" <a href="+this.tiles[p].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'></img></a></td><td id='pv-facet' class='tooltipcustom' title='Clear relation selection' style='color:#009933;cursor:pointer'>"+s+"</td><td id='pv-value' class='tooltipinter' title='Filter on this value' style='color:#009933;cursor:pointer'>"+t+"</td></tr>"}):this.IsUri(t)?h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipcustom' title='Toggle item selection'>"+q+"</td><td id='pv-facet' class-'tooltipcustom' title='Clear relation selection' style='color:#009933;cursor:pointer'>"+s+"</td><td id='pv-value' class='tooltipinter' title='Filter on this value' style='color:#009933;cursor:pointer'>"+t+" <a href="+t+" target=\"_blank\"><img style='cursor:default;' id=pv-linkout' title='Follow the link' src='images/goout.gif'></img></a></td></tr>"}):h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipcustom' title='Toggle item selection'>"+q+"</td><td id='pv-facet' class-'tooltipcustom' title='Clear relation selection' style='color:#009933;cursor:pointer'>"+s+"</td><td id='pv-value' class='tooltipinter' title='Filter on this value' style='color:#009933;cursor:pointer'>"+t+"</td></tr>"}):this.tiles[p].facetItem.Href?this.IsUri(t)?h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipinter' title='Click the cell to select this item' style='color:#009933;cursor:pointer'>"+q+" <a href="+this.tiles[p].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'></img></a></td><td id='pv-facet' class='tooltipcustom' title='Clear relation selection' style='color:#009933;cursor:pointer'>"+s+"</td><td id='pv-value'><a href="+t+">"+t+"</a></td></tr>"}):h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipinter' title='Click the cell to select this item' style='color:#009933;cursor:pointer'>"+q+" <a href="+this.tiles[p].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'></img></a></td><td id='pv-facet' class='tooltipcustom' title='Clear relation selection' style='color:#009933;cursor:pointer'>"+s+"</td><td id='pv-value'>"+t+"</td></tr>"}):this.IsUri(t)?h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipcustom' title='Toggle item selection'>"+q+"</td><td id='pv-facet' class-'tooltipcustom' title='Clear relation selection' style='color:#009933;cursor:pointer'>"+s+"</td><td id='pv-value'><a href"+t+">"+t+"</a></td></tr>"}):h.push({key:r,value:"<tr class='pv-tableview-"+m+"'><td id='pv-key' class='tooltipcustom' title='Toggle item selection'>"+q+"</td><td id='pv-facet' class-'tooltipcustom' title='Clear relation selection' style='color:#009933;cursor:pointer'>"+s+"</td><td id='pv-value'>"+t+"</td></tr>"}),m="odd-row"==m?"even-row":"odd-row"}break}}}if(0==h.length)this.CreateTable(a,"",c,d);else{h.sort(function(a,b){return a.key>b.key?1:a.key<b.key?-1:0}),d&&h.reverse();for(var o=0;o<h.length;o++)n+=h[o].value;n+="</table>",f.append(n),$("#pv-table-data").colResizable({disable:!0}),$("#pv-table-data").colResizable({disable:!1}),$(".pv-tableview-heading").on("click",function(a){var b=a.originalEvent.target.id,c=[];$(".tooltipinter").tooltipster("hide"),$(".tooltipcustom").tooltipster("hide"),""==e.selectedId||null==e.selectedId?c=e.currentFilter:c[0]=e.selectedId;var d;"pv-key"==b?(d=!e.sortReverseEntity,e.sortReverseEntity=d):"pv-facet"==b?(d=!e.sortReverseAttribute,e.sortReverseAttribute=d):"pv-value"==b&&(d=!e.sortReverseValue,e.sortReverseValue=d),e.sortKey=b,e.CreateTable(c,e.selectedFacet,b,d)}),$(".pv-tableview-odd-row").on("click",function(a){$(".tooltipinter").tooltipster("hide"),$(".tooltipcustom").tooltipster("hide");var b=a.originalEvent.target.id;e.CellClick(b,a.currentTarget.cells)}),$(".pv-tableview-even-row").on("click",function(a){$(".tooltipinter").tooltipster("hide"),$(".tooltipcustom").tooltipster("hide");var b=a.originalEvent.target.id;e.CellClick(b,a.currentTarget.cells)})}},Selected:function(a){var b=[];""==a||null==a||void 0==typeof a?(this.selectedId="",this.CreateTable(this.currentFilter,this.selectedFacet)):(b[0]=a,this.selectedId=a,this.CreateTable(b,this.selectedFacet))},SetFacetCategories:function(a){this.categories=a.FacetCategories},IsFilterVisible:function(a){var b=null;for(i=0;i<this.categories.length;i++)this.categories[i].Name==a&&(b=this.categories[i].IsFilterVisible);return null!=b&&b},SetFacetCategories:function(a){this.categories=a.FacetCategories},IsUri:function(a){var b=a,c=!1;return"string"==typeof a&&("http:"==b.substring(0,5)&&(c=!0),"https:"==b.substring(0,6)&&(c=!0)),c},SetSelectedFacet:function(a){this.selectedFacet=a},GetSelectedFacet:function(){return this.selectedFacet}}),PivotViewer.Views.TileController=Object.subClass({init:function(a){this._tiles=[],this._helpers=[],this._helperText="",this._easing=new Easing.Easer({type:"circular",side:"both"}),this._imageController=a},initTiles:function(a,b,c){for(var d=0;d<a.length;d++){var e=new PivotViewer.Views.Tile(this._imageController);e.facetItem=a[d],e.CollectionRoot=b.replace(/\\/gi,"/").replace(/\.xml/gi,""),this._canvasContext=c,e.context=this._canvasContext,tileLocation=new PivotViewer.Views.TileLocation,e._locations.push(tileLocation),this._tiles.push(e)}return this._tiles},AnimateTiles:function(a,b){var c=this;this._started=!0;var d=null,e=!1;if(this._tiles.length>0&&null!=this._tiles[0].context){d=this._tiles[0].context;for(var f=!1,g=0;g<this._tiles.length;g++)for(k=0;k<this._tiles[g]._locations.length;k++){var h=PivotViewer.Utils.Now()-this._tiles[g].start,i=this._tiles[g].end-this._tiles[g].start;if(h<=i)this._tiles[g]._locations[k].x==this._tiles[g]._locations[k].destinationx&&this._tiles[g]._locations[k].y==this._tiles[g]._locations[k].destinationy||(f=!0),this._tiles[g]._locations[k].x=this._easing.ease(h,this._tiles[g]._locations[k].startx,this._tiles[g]._locations[k].destinationx-this._tiles[g]._locations[k].startx,i),this._tiles[g]._locations[k].y=this._easing.ease(h,this._tiles[g]._locations[k].starty,this._tiles[g]._locations[k].destinationy-this._tiles[g]._locations[k].starty,i),this._tiles[g].width==this._tiles[g].destinationWidth&&this._tiles[g].height==this._tiles[g].destinationHeight||(f=!0),this._tiles[g].width=this._easing.ease(h,this._tiles[g].startwidth,this._tiles[g].destinationwidth-this._tiles[g].startwidth,i),this._tiles[g].height=this._easing.ease(h,this._tiles[g].startheight,this._tiles[g].destinationheight-this._tiles[g].startheight,i);else if(this._tiles[g]._locations[k].x=this._tiles[g]._locations[k].destinationx,this._tiles[g]._locations[k].y=this._tiles[g]._locations[k].destinationy,this._tiles[g].width=this._tiles[g].destinationwidth,this._tiles[g].height=this._tiles[g].destinationheight,!isNaN(h)&&!isNaN(i)&&a){var j="";for(t=0;t<this._tiles.length;t++)if(this._tiles[t].facetItem.Id==b){j=this._tiles[t];break}b&&j&&$.publish("/PivotViewer/Views/Canvas/Click",[{x:j._locations[j.selectedLoc].destinationx,y:j._locations[j.selectedLoc].destinationy}]),a=!1,b=0}this._tiles[g]._locations[k].destinationx+this._tiles[g].destinationwidth<0||this._tiles[g]._locations[k].destinationx>d.canvas.width||this._tiles[g]._locations[k].destinationy+this._tiles[g].destinationheight<0||this._tiles[g]._locations[k].destinationy>d.canvas.height?this._tiles[g].destinationVisible=!1:this._tiles[g].destinationVisible=!0}}this._isZooming!=f&&(this._isZooming=f,$.publish("/PivotViewer/ImageController/Zoom",[this._isZooming])),d.clearRect(0,0,d.canvas.width,d.canvas.height);for(var g=0;g<this._tiles.length;g++)for(var k=0;k<this._tiles[g]._locations.length;k++)this._tiles[g]._locations[k].x+this._tiles[g].width>0&&this._tiles[g]._locations[k].x<d.canvas.width&&this._tiles[g]._locations[k].y+this._tiles[g].height>0&&this._tiles[g]._locations[k].y<d.canvas.height&&(e?this._tiles[g].DrawEmpty(k):this._tiles[g].Draw(k));return this._breaks?void(this._started=!1):void requestAnimFrame(function(){c.AnimateTiles(a,b)})},BeginAnimation:function(a,b){!this._started&&this._tiles.length>0&&(this._breaks=!1,this.AnimateTiles(a,b))},StopAnimation:function(){this._breaks=!0},SetLinearEasingBoth:function(){
this._easing=new Easing.Easer({type:"linear",side:"both"})},SetCircularEasingBoth:function(){this._easing=new Easing.Easer({type:"circular",side:"both"})},SetQuarticEasingOut:function(){this._easing=new Easing.Easer({type:"quartic",side:"out"})},GetMaxTileRatio:function(){return this._imageController.MaxRatio},DrawHelpers:function(a){this._helpers=a},DrawHelperText:function(a){this._helperText=a}}),PivotViewer.Views.Tile=Object.subClass({init:function(a){return this instanceof PivotViewer.Views.Tile?(this._controller=a,this._imageLoaded=!1,this._selected=!1,this._images=null,void(this._locations=[])):new PivotViewer.Views.Tile(a)},IsSelected:function(){return this._selected},Draw:function(a){if(this.destinationVisible&&(this._images=this._controller.GetImages(this.facetItem.Img,this.width,this.height)),null!=this._images){if("function"==typeof this._images)this._images(this.facetItem,this.context,this._locations[a].x+4,this._locations[a].y+4,this.width-8,this.height-8);else if(this._images.length>0&&this._images[0]instanceof Image){var b=this._controller.GetHeight(this.facetItem.Img),c=this.height-8,d=Math.ceil(this._controller.GetWidthForImage(this.facetItem.Img,c));if(blankWidth=this.width-8-d,this._controller instanceof PivotViewer.Views.DeepZoomImageController)for(var e=0;e<this._images.length;e++){var f=this._images[e].src,g=this._controller._tileSize,h=f.match(/[0-9]+_[0-9]+/g),i=parseInt(h[h.length-1].substring(0,h[h.length-1].indexOf("_"))),j=parseInt(h[h.length-1].substring(h[h.length-1].indexOf("_")+1));h=f.match(/_files\/[0-9]+\//g);var k=parseInt(h[0].substring(7,h[0].length-1)),l=Math.ceil(b/Math.pow(2,this._controller.GetMaxLevel(this.facetItem.Img)-k)),m=c/l;overlap=this._controller.GetOverlap(this.facetItem.Img);var n=Math.floor(blankWidth/2)+4+i*Math.floor((g-overlap)*m),o=4+Math.floor(j*(g-overlap)*m),p=Math.ceil(this._images[e].height*m),q=Math.ceil(this._images[e].width*m);this.context.drawImage(this._images[e],n+this._locations[a].x,o+this._locations[a].y,q,p)}else{var n=Math.floor(blankWidth/2)+4,o=4;this.context.drawImage(this._images[0],n+this._locations[a].x,o+this._locations[a].y,d,c)}if(this._selected){this.context.beginPath();var n=Math.floor(blankWidth/2)+4,o=4;this.context.rect(n+this._locations[this.selectedLoc].x,o+this._locations[this.selectedLoc].y,d,c),this.context.lineWidth=4,this.context.strokeStyle="#92C4E1",this.context.stroke()}}}else this.DrawEmpty(a)},Contains:function(a,b){var c=!1,d=-1;for(i=0;i<this._locations.length;i++)c=this._locations[i].x<=a&&this._locations[i].x+this.width>=a&&this._locations[i].y<=b&&this._locations[i].y+this.height>=b,c&&(d=i);return d},DrawEmpty:function(a){void 0==this._controller.DrawLevel?(this.context.beginPath(),this.context.fillStyle="#D7DDDD",this.context.fillRect(this._locations[a].x+4,this._locations[a].y+4,this.width-8,this.height-8),this.context.rect(this._locations[a].x+4,this._locations[a].y+4,this.width-8,this.height-8),this.context.lineWidth=1,this.context.strokeStyle="white",this.context.stroke()):this._controller.DrawLevel(this.facetItem,this.context,this._locations[a].x+4,this._locations[a].y+4,this.width-8,this.height-8)},CollectionRoot:"",now:null,end:null,width:0,height:0,origwidth:0,origheight:0,ratio:1,startwidth:0,startheight:0,destinationwidth:0,destinationheight:0,destinationVisible:!0,context:null,facetItem:null,firstFilterItemDone:!1,selectedLoc:0,Selected:function(a){this._selected=a}}),PivotViewer.Views.TileLocation=Object.subClass({init:function(){},x:0,y:0,startx:0,starty:0,destinationx:0,destinationy:0}),PivotViewer.Views.SimpleImageController=PivotViewer.Views.IImageController.subClass({init:function(){this._items=[],this._collageItems=[],this._baseUrl="",this._collageMaxLevel=0,this._tileSize=256,this._format="",this._ratio=1,this.MaxRatio=1,this._loadedCount=0,this._zooming=!1;var a=this;$.subscribe("/PivotViewer/ImageController/Zoom",function(b){a._zooming=b})},Setup:function(a,b){this._baseUrl=a;for(var c=this,d=0;d<b.length;d++){var e=new Image;e.onload=function(){for(var a=0;a<c._items.length;a++)c._items[a].Images[0]==this&&(c._items[a].Width=this.width,c._items[a].Height=this.height,c._loadedCount++,c._loadedCount==c._items.length&&$.publish("/PivotViewer/ImageController/Collection/Loaded",null))},e.onerror=function(){this.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIIAAACCCAYAAACKAxD9AAAGyklEQVR4Xu2dgdUVNRCFhwrUCoQKlAqQCtQK0AqUCoAKkAqQCvSvAKxArUCtQK1Az4VdXJa3vmQ3czN7M3vOO3DOv5tNZr5MJpNJ9pbllRIws1sphZQAJJAgJAevJZAgJAgJQjLwnwTSIiQNaRGSgbQIycBKAjk0JBJDDA33zOxTM7s9/fvh9G+J+n83M/z+MrNfpv/j319LHj7bPWoW4WMz+2L6feaojFdmNv9+cnwPrWgFED6YFP9tRW9vKWBYjB+n303LgpllnRkEAADl4weTH+HCUPK9mX1nZn9HqFBpHc4IQkQA1vKGlQAMpwHibCB8PgkXzt8ZrhmIJ9ErexYQYAXQu76KLtCN+mG2gbqHnXGcAYRPpnEX08CzX/BnnkVsRHQQEAeARx7FGWyhQziTX7coqGUZkUF4MFmClu2NUhaGCsQ5wswsooKgDMEMYygYIoKA4QBRuxEutPN+hIZGAwGOIYSj5BNc03MInyESCJgiAgKF2cE15a//jqnli9qHWt4fCYTnJ44THNUJAk/oAH8cLWjv81FAQMQQ08SRr67+QgQQMCTAgz5L2NgTVkwpuyxrRwDhkZk99pTuicrG6uWdHvXtDQISSWANmLMEvG9OKoHgl/F/1GfOZkLvRJIL+8I76XkNvUFgOojwQbBwVWN6AQY8eqbF6uIr9AQBvgG8Ze8L70AvqwFgXSf2whesEnUG0RMEhm/QMozLjHPQVyl7gvCb80yhJQSzhWD5NKj7XW9TuSy/Fwje6wmeARrWghhVN9SXLQj0dhK9Tau3NYOoqDGFXiD86ThlZHjd30wzEE/rjZkKLdexBwjwwDEGel2MngRfATEIz0seBM/exIzMeVo1AMawbG9B7mERfnCM2Hn7BksL8HIax72sgjwIno4WMxDj7fBKg+AZTWQOC7AC3gExaRA84wdYS/jSy05fKDdBOCBsz2AM1ctOi3CAAmfhMaaNy9Z7+whYKX14TNzlT7NnDZ7mlA2C96yBauHYIHgKj92Wf8r72647qZnNbOGpgMBItqVauARhV2c1b/8AtUL6Hm1vJBuEfWKP9RRjnYEdE8lDuXcw5hkin6tD3waXFqGOBM84yLIm9EzmBKEcBNYGXWRXYc2E5h9ABAlCGQgsCFAb+rCQIMSDADWiThtnEaRF+H8YEC9AD2XtxKKuOC6bniBsg+CZSbX11i7WIIeGy+rodaZjF98gh4bLELC3ts216DJTyKHhMgRsf2BZi25DQlqEd2HwXB6/NjdhJtxu1iWdRaMsIG0poKtfkEPDGwnAKYQiehyG0S1wtEXkqBaBucX9kuzDWILRfQRGPsFW56NmHl1zUEYG4en0+Z9SGbW6r8XJLa3q8l45ow0NjBSzS8rCpl/4ItTjcGqoGQkE1mkna/lTs5FrlD/qrIGRWbSUbeihYA3MKBbBc6vdpU6I7XdwCqnJJXutAZ4bBQTPNPq1/ENECmuhGAEEljU41VAw4tDA8A3CzwquWQh1i+B5HsMsW4/zHK/prfnf1UHwzjKSgGAEZ9FzWOieTNLSLKhbBM8dy/j0TthP/NZCogyC52zhFNHCGhiUQfDyD+gbVGsUuvdeZRC8VhlDLiPvBWCEZWiPaCIcxI+OCj3i88oW4WeHj4mGyyxqBZUyCB4zBvp29VaKvlZOgnBNQu/+nXqcTV3Vjt2dINTJT1Zesg0zM4+hQVZesg1LENLUzRJIi1DBQlqECmEpZ3QlCAnCawkog4BFp9bXkc8Kt65L0/KUQWgqKPXCEgR1DRe2L0EoFJT6bQmCuoYL25cgFApK/bYEQV3Dhe1LEAoFpX5bgqCu4cL2jQYCDtREziFS0XG24fLCOcjYsIIsJJk09UIOpCOLSxkAAHxHca38LTkBCuxqHgaIESzCkcM05fYvbJGvDkKL09NkE1aXUCiDcMQSrDuOvGVQBQE+ARy/llf3g7NbNmZdlioIHptbun1dxROAuWxFEDyswSwvWaugCILXnkfAgCnoQ0YPZb9DEQSPrW6zXuB33GUrifE+RRA8spflZ1oJQn13U5SZZIg5LUI93AlCyuyNBBTNnKezKHlsjioILdYXtgyF7LqDokXwPE0tA0o7xtKej3gMD7LDgurQgHZ5WAVZa6AMAtrWMtQsG1pWXnRaDkktHEdZB1E+XLpyTo5YBnlLMIpFmNsJnwE9+3ahBwvHENnOstvgR0lM2dI3vvuIsxLh+K2hgPKRfIIPc90UAiNzm2IcQUY5zIYkCExpB35XghBYOcyqJQhMaQd+V4IQWDnMqiUITGkHfleCEFg5zKolCExpB35XghBYOcyq/QsDpBSSxr85bAAAAABJRU5ErkJggg=="},""==c._baseUrl?e.src=b[d]:e.src=c._baseUrl+"/"+b[d],c._items.push(new PivotViewer.Views.SimpleImageItem(b[d],c._baseUrl,e.width,e.height,e))}},GetImages:function(a,b,c){if(b>8&&c>8)for(var d=0;d<this._items.length;d++)if(this._items[d].ImageId==a)return this._items[d].Images;return null},GetWidthForImage:function(a,b){for(var c=0;c<this._items.length;c++)if(this._items[c].ImageId==a)return Math.floor(b/(this._items[c].Height/this._items[c].Width))},GetWidth:function(a){for(var b=0;b<this._items.length;b++)if(this._items[b].ImageId==a)return this._items[b].Width},GetHeight:function(a){for(var b=0;b<this._items.length;b++)if(this._items[b].ImageId==a)return this._items[b].Height},GetRatio:function(a){for(var b=0;b<this._items.length;b++)if(this._items[b].ImageId==a)return this._items[b].Height/this._items[b].Width}}),PivotViewer.Views.SimpleImageItem=Object.subClass({init:function(a,b,c,d,e){this.ImageId=a,this.BasePath=b,this.Images=[e],this.Width=c,this.Height=d}}),PivotViewer.Views.DeepZoomImageController=PivotViewer.Views.IImageController.subClass({init:function(){this._items=[],this._collageItems=[],this._baseUrl="",this._collageMaxLevel=0,this._tileSize=256,this._format="",this._ratio=1,this.MaxRatio=1,this._zooming=!1;var a=this;$.subscribe("/PivotViewer/ImageController/Zoom",function(b){a._zooming=b})},Setup:function(a){this._baseUrl=a.substring(0,a.lastIndexOf("/")),this._collageUrl=a.substring(a.lastIndexOf("/")+1).replace(".xml","_files");var b=this;$.ajax({type:"GET",url:a,dataType:"xml",success:function(a){var c=$(a).find("Collection");b._tileSize=$(c).attr("TileSize"),b._format=$(c).attr("Format"),b._collageMaxLevel=$(c).attr("MaxLevel");var d=$(a).find("I");if(0!=d.length){var e=$(d[0]).find("Size");if(e.length>0)for(b.MaxWidth=parseInt(e.attr("Width")),b.Height=parseInt(e.attr("Height")),b.MaxRatio=b.Height/b.MaxWidth,i=0;i<d.length;i++){itemSize=$(d[i]).find("Size");var f=parseInt(itemSize.attr("Width")),g=parseInt(itemSize.attr("Height")),h=f>g?f:g,j=Math.ceil(Math.log(h)/Math.log(2));b._ratio=g/f;var k=$(d[i]).attr("Source"),l=$(d[i]).attr("Id"),m=$(d[i]).attr("N"),n=k.substring(k.lastIndexOf("/")+1).replace(/\.xml/gi,"").replace(/\.dzi/gi,""),o=k.substring(0,k.lastIndexOf("/"));o.length>0&&(o+="/"),f>b.MaxWidth&&(b.MaxWidth=f),b._ratio<b.MaxRatio&&(b.MaxRatio=b._ratio),b._items.push(new PivotViewer.Views.DeepZoomItem(l,n,m,o,b._ratio,f,g,j,b._baseUrl,k))}$.publish("/PivotViewer/ImageController/Collection/Loaded",null)}else{$(".pv-loading").remove();var p="";p+="No items in the DeepZoom Collection<br><br>",p=p+"URL        : "+this.url+"<br>",p+="<br>Pivot Viewer cannot continue until this problem is resolved<br>",$(".pv-wrapper").append('<div id="pv-dzloading-error" class="pv-modal-dialog"><div><a href="#pv-modal-dialog-close" title="Close" class="pv-modal-dialog-close">X</a><h2>HTML5 PivotViewer</h2><p>'+p+"</p></div></div>");setTimeout(function(){window.open("#pv-dzloading-error","_self")},1e3)}},error:function(a,b,c){$(".pv-loading").remove();var d="";d+="Error loading from DeepZoom Cache<br><br>",d=d+"URL        : "+this.url+"<br>",d=d+"Status : "+a.status+" "+c+"<br>",d=d+"Details    : "+a.responseText+"<br>",d+="<br>Pivot Viewer cannot continue until this problem is resolved<br>",$(".pv-wrapper").append('<div id="pv-dzloading-error" class="pv-modal-dialog"><div><a href="#pv-modal-dialog-close" title="Close" class="pv-modal-dialog-close">X</a><h2>HTML5 PivotViewer</h2><p>'+d+"</p></div></div>");setTimeout(function(){window.open("#pv-dzloading-error","_self")},1e3)}})},GetImagesAtLevel:function(a,b){b=b<=0?6:b;for(var c=0;c<this._items.length;c++)if(this._items[c].ItemId==a){b=b>this._items[c].MaxLevel?this._items[c].MaxLevel:b;for(var d=this._items[c].DZN.toString(2),e="",f="",g=0;g<d.length;g++)g%2==0?e+=d[g]:f+=d[g];if(dzCol=parseInt(e,2),dzRow=parseInt(f,2),!(void 0!=this._items[c].Levels&&0!=this._items[c].Levels.length||this._zooming)){var h=this.GetImageList(c,this._baseUrl+"/"+this._items[c].BasePath+this._items[c].DZId+"_files/6/",6),i=new PivotViewer.Views.LoadImageSetHelper;return i.LoadImages(h),this._items[c].Levels.push(i),null}if(this._items[c].Levels.length<b&&!this._zooming){var h=this.GetImageList(c,this._baseUrl+"/"+this._items[c].BasePath+this._items[c].DZId+"_files/"+b+"/",b),i=new PivotViewer.Views.LoadImageSetHelper;i.LoadImages(h),this._items[c].Levels.splice(b,0,i)}for(var j=b;j>-1;j--){if(void 0!=this._items[c].Levels[j]&&this._items[c].Levels[j].IsLoaded())return this._items[c].Levels[j].GetImages();if(j==b&&void 0==this._items[c].Levels[j]&&!this._zooming){var h=this.GetImageList(c,this._baseUrl+"/"+this._items[c].BasePath+this._items[c].DZId+"_files/"+j+"/",j),i=new PivotViewer.Views.LoadImageSetHelper;i.LoadImages(h),this._items[c].Levels.splice(j,0,i)}}return null}return null},GetImageList:function(a,b,c){for(var d=[],e=this._tileSize,f=this._format,g=this._items[a].Ratio,h=this._items[a].Height,i=this._items[a].MaxLevel,j=Math.ceil(h/g/Math.pow(2,i-c)),k=Math.ceil(h/Math.pow(2,i-c)),l=Math.ceil(j/e),m=Math.ceil(k/e),n=0;n<l;n++)for(var o=0;o<m;o++)d.push(b+n+"_"+o+"."+f);return d},GetWidthForImage:function(a,b){for(var c=0;c<this._items.length;c++)if(this._items[c].ItemId==a)return Math.floor(b/this._items[c].Ratio)},GetDzi:function(a){for(var b=0;b<this._items.length;b++)if(this._items[b].ItemId==a)return dziName=this._baseUrl+"/"+this._items[b].BasePath+this._items[b].DZId+".dzi",dziName},GetMaxLevel:function(a){for(var b=0;b<this._items.length;b++)if(this._items[b].ItemId==a)return this._items[b].MaxLevel},GetWidth:function(a){for(var b=0;b<this._items.length;b++)if(this._items[b].ItemId==a)return this._items[b].Width},GetHeight:function(a){for(var b=0;b<this._items.length;b++)if(this._items[b].ItemId==a)return this._items[b].Height},GetOverlap:function(a){for(var b=0;b<this._items.length;b++)if(this._items[b].ItemId==a)return this._items[b].Overlap},GetRatio:function(a){for(var b=0;b<this._items.length;b++)if(this._items[b].ItemId==a)return this._items[b].Ratio}}),PivotViewer.Views.DeepZoomItem=Object.subClass({init:function(a,b,c,d,e,f,g,h,i,j){this.ItemId=a,this.DZId=b,this.DZN=parseInt(c),this.BasePath=d,this.Levels=[],this.Ratio=e,this.Width=f,this.Height=g,this.MaxLevel=h;var k=this;$.ajax({type:"GET",url:i+"/"+j,dataType:"xml",success:function(a){var b=$(a).find("Image");if(0!=b.length){var c=$(b[0]);k.Overlap=c.attr("Overlap")}},complete:function(a,b){},error:function(a,b,c){k.Overlap=0}})}}),function(a){PivotViewer.PivotViewerViewport=PivotViewer.IPivotViewerViewport.subClass({GetViewportWidth:function(){return A.width()},GetViewportHeight:function(){return a(".pv-mainpanel").height()},GetOffsetX:function(){return a(".pv-filterpanel").width()+18},GetOffsetY:function(){return 4}});var b,c,d=[],e=[],f=[],g=[],h=[],k=[],m=[],n=0,o=[],p=[],q="",r=0,s="",u="",v=!1,w="",x=null,y=null,z={View:null,Facet:null,Filters:[]},A=null,B={},C=new PivotViewer.Models.Collection,D=new PivotViewer.PivotViewerViewport,E={init:function(a){if(A=this,A.addClass("pv-wrapper"),InitPreloader(),void 0!=a.ViewerState)for(var b=a.ViewerState.split("&"),d=0,e=b.length;d<e;d++){var f=b[d].split("=");if(2==f.length)if("$view$"==f[0])z.View=parseInt(f[1])-1;else if("$facet0$"==f[0])z.Facet=PivotViewer.Utils.EscapeItemId(f[1]);else if("$selection$"==f[0])z.Selection=PivotViewer.Utils.EscapeItemId(f[1]);else if("$tableFacet$"==f[0])z.TableFacet=PivotViewer.Utils.EscapeItemId(f[1]);else{for(var g={Facet:f[0],Predicates:[]},h=f[1].split("_"),i=0,j=h.length;i<j;i++)if(h[i].indexOf(".")>0){var k=h[i].substring(0,h[i].indexOf(".")),l=h[i].substring(h[i].indexOf(".")+1);g.Predicates.push({Operator:k,Value:l})}z.Filters.push(g)}}if(void 0==a.Loader)throw"Collection loader is undefined.";if(a.Loader instanceof PivotViewer.Models.Loaders.ICollectionLoader)a.Loader.LoadCollection(C);else{if(!(defaultOptions.Loader instanceof PivotViewer.Models.Loaders.ICollectionLoader))throw"Collection loader does not inherit from PivotViewer.Models.Loaders.ICollectionLoader.";defaultOptions.Loader.LoadCollection(C)}if(void 0==a.ImageController)c=new PivotViewer.Views.SimpleImageController;else{if(!(a.ImageController instanceof PivotViewer.Views.IImageController))throw"Image Controller does not inherit from PivotViewer.Views.IImageController.";c=a.ImageController}},show:function(){Debug.Log("Show")},hide:function(){Debug.Log("Hide")},refresh:function(){ResizeView(!0)}};ResizeView=function(c){ResizeView.FilterPanel(),ResizeView.InfoPanel(),ResizeView.Breadcrumb();var d=a(".pv-viewarea-canvas")[0];d&&(d.width=A.width(),d.height=a(".pv-viewpanel").height()),c&&b&&FilterCollection(!1)},ResizeView.Breadcrumb=function(){var b=a(".pv-toolbarpanel-zoomcontrols").outerWidth(!0)+a(".pv-toolbarpanel-viewcontrols").outerWidth(!0)+a(".pv-toolbarpanel-sortcontrols").outerWidth(!0),c=a(".pv-toolbarpanel-brandimage").outerWidth(!0)+a(".pv-toolbarpanel-name").outerWidth(!0),d=c+b,e=a(".pv-toolbarpanel-facetbreadcrumb").outerWidth(!0)-a(".pv-toolbarpanel-facetbreadcrumb").innerWidth(),f=a(".pv-toolbarpanel").innerWidth()-d-e-4;a(".pv-toolbarpanel-facetbreadcrumb").width(f)},ResizeView.FilterPanel=function(){ResizeView.verticalCenter(".pv-filterpanel",".pv-filterpanel-search",".pv-filterpanel-version",".pv-filterpanel-accordion",3)},ResizeView.InfoPanel=function(){ResizeView.verticalCenter(".pv-infopanel",".pv-infopanel-heading",".pv-infopanel-footer",".pv-infopanel-details",8)},ResizeView.verticalCenter=function(b,c,d,e,f){var g=a(b),h=a(e),i=a(c),j=a(d);if(g.length>0&&h.length>0){var k=(i.length>0?i.position().top+i.outerHeight(!0):0)+f,l=(j.length>0?g.innerHeight()-j.position().top:0)+f;h.css({top:k+"px",bottom:l+"px"})}},InitPreloader=function(){A.append("<div class='pv-loading'><img src='data:image/gif;base64,R0lGODlhIAAgAPYAAP///wAAAPr6+tbW1tra2vz8/Lq6uoCAgIqKisDAwPb29ujo6IiIiH5+fqCgoObm5nBwcFJSUoKCguTk5PLy8nx8fKKioq6urjY2Njo6OkBAQGpqatzc3PT09Hp6eqampvj4+MjIyDw8PGxsbOrq6p6ennh4eL6+vtLS0jQ0NDg4OKysrMbGxszMzO7u7tTU1DAwMLS0tLy8vKioqPDw8G5ubpKSktjY2OLi4oaGhhISEhAQECQkJA4ODi4uLpqamuDg4N7e3uzs7LCwsJycnJaWlmJiYo6OjpSUlEZGRkxMTFBQUEREREpKSpCQkM7OzkhISEJCQtDQ0MLCwk5OTpiYmBoaGigoKDIyMhYWFhQUFLi4uFpaWlRUVKSkpHJyclhYWF5eXmRkZFxcXFZWViIiIiAgIB4eHioqKsrKysTExGhoaLa2tmZmZiwsLKqqqhgYGGBgYBwcHHR0dHZ2drKysiYmJoSEhD4+PoyMjAwMDAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJBQAAACwAAAAAIAAgAAAH/4AAgoOEhYaHiImKi4yNjo+QkZKECzk2NJOCDxchgwU1OjsSmQoQGCIWghQiOz01npALERkYGQ4AFBqtP4ILN0ACjgISGhkpGDIANjw+KABCKNEujxMbGiowowAEHIIT0SgUkBwjGiIzhkIvKDiSJCsxwYYdmI8KFB0FjfqLAgYMEiSUEJeoAJABBAgiGnCgQQUPJlgoIgGuWyICCBhoRNBCEbRoFhEVSODAwocTIBQVwEEgiMJEChSkzNTPRQdEFF46KsABxYtphUisAxLpW7QJgkDMxAFO5yIC0V5gEjrg5kcUQB098ElCEFQURAH4CiLvEQUFg25ECwKLpiCmKBC6ui0kYILcuXjz6t3Ld1IgACH5BAkFAAAALAAAAAAgACAAAAf/gACCg4SFhoeIiYqLjI2Ohw8Tj44XKlhbk4sKEVZZXAWZgwsxLYMdTJ1RCqEAIA1JSjOCFKhaUSCCoI8kRkpMULIKVFZaXaALN0C6jAVHS01RTFMAVVc8XgBCKNsujwsmS1AaCIJSpQAT2ygUk0AeS0oXhkIvKDihQjEyy4QdNJMgOqxqxC9RCyJFkKwYiKgAkAEE2CWi4CChDSdSFJFQx0ERiCEWQlq4oUjbto6KgCQwIOOJAEUFcBAIInGRgIKsGrrogIhCzUcFgqB40a0QiXpAMj1QJ6kVLgA41P1kxGHbi39HB/A0iaKoo6MvSAgisC0pAGRBXk4SOOjGtiCDFXCGSodCSM6GC7ze3cu3r9+/gAcFAgAh+QQJBQAAACwAAAAAIAAgAAAH/4AAgoOEhYaHiImKi4yNjoYkTj8Uj40SPGUMlYsdSzxmSiCbg0IyKIM0TTxnTAqjACAIYGNDgh1Uq1CiAB2VLl9hZGAXsGSrXAUKEjNABY4FRGJjXV0sAD8+aB8ANmItKC6PJAxiXBFIAAIhIYJVUygolI8TCNIxhkAvKDijLidTzgx1oLEJxC5GAReRkLFixZSDhwoAGUBAXiIWQy6smMFBEQl4KDoqenKi5Al+iYSAFJmIwgAUL5opKoCDQBCLM189c9HrEAWcz4LADFeIhD4gmxaAnCDIoCAcIIEuEgqToNEBvVTCI+rIxYAXJAQRgIcUwIIbQQQUPHiD7KCEOhMBTIAnJG7EBVzt6t3Lt6/fvYEAACH5BAkFAAAALAAAAAAgACAAAAf/gACCg4SFhoeIiYqLjI2OhiRVDhSPjQhYPkeViwpjWG5dIJuDBTdBgxRkWGhKCqOCK18QW4IdXKsRogAPHY8FNl8bG2wAIEarRgUKDW4ROI8XHl9rbS0ADhkYbwBIWj1wU48uPx4QYg4ABS1pgm09ZUc0lQtE5SeGR1hEz5sUIWkFDAkAIq9SAQGOAjIC8YLFFBQIExUAMoAAJUU41oVQs0ARCRQgOSyaABKkC0VCSopUJADHjRsTFhXAQSDIRZmvErrodYjCTV9BULw4WYjECxRANn0EGbNYRBwlfzIiKVSe0Ru9UpqsRGHAABKCCIBMCmCBqYiPBKC9MZZUTkJUEIW8PVRgAdG5ePPq3ctXbyAAIfkECQUAAAAsAAAAACAAIAAAB/+AAIKDhIWGh4iJiouMjY6GQhZDHY+NSFEiRZWLCmtRGXEgm4QgCoMdYhoZYKajAA9ETmqCnRoqY6IACy6VCQgHDQkAIBAaGCMAChIpShyPTzYMDR4oADNQUUMAVXJZOj+PHRdOOR4rAAVST4Ij3joXlS7jOSyGNnA7YRSbHSgvhyAMvBHiqlEBgxNu3MCxqACQAQT2KXKBoiIKGopIWHQ20eJFRUI2NsShcMJIAkEkNixo0AWlQxRUPioQxB+vQiReoACySWNFk8MECMJhUSajCRVfYMx5g1LIijcdKSAwgIQgAhV56roBRGilAgcF3cg6KCxLAEhREDxbqACJqGwI48qdS7fuqEAAIfkECQUAAAAsAAAAACAAIAAAB/+AAIKDhIWGh4iJiouMjY6GLitsCo+NJRFUM5WLICYRTSMCm4kdc59iIIIgLw+VT2woggp0EVBrogtfblFSjhNeP0hpAAINEUl0AApfZWdyTr4rFkVOBAB1YBFsAD92zlZ1jiBTbw42WwAFL7ECRmZycEYUjxRqbyW9hUfwRiSbIEGCHKLwxoKQUY1AUCjQiAQBAhMWFWjRgkCHRRRQaERBQxGJjRwwbuSoSAhIRg9u3IioqAAOAkAuMmKIsFEBFzINUZi3qUAQFC9cGCKxDsimjxpZghAFAMdGno4eaHzRkeiNiyY1Cn0EgsAAfwAIaDQKYMENIEwr0QRwY+ygtTUUAUzQeDCuoQIkttrdy7ev3799AwEAIfkECQUAAAAsAAAAACAAIAAAB/+AAIKDhIWGh4iJiouMjY6GBQMDj45sI20ylIsgDG1jBwWaiQp3nl8ggiAyQxSPJCgPqZ1cdAIAJB4pbkeOCmoxF5MCR21cEgAKFTBodmO2jB0hqzM4ADIjRpkOKcw8P48cLAYrIQAFN5MFI252ZRutjiAELFschkVXZWskmgUkC4coXPjgQlQjEDj4MSJBgMCERRPA2MlgYJGCFygy0lCE5MwVH21QjcKoUREBNglY3GC04MaNh4oK4CAARIHBm4gKuOiAiAI8SgWCoHhRsBAJjEA0vcoIE8QzHBlR/Gz0IOOLjUdv8BQStWg8AjcUEsiYFEBLIM+ADrpBdlAonIIRJmQUAhcSCa918+rdy7evqEAAIfkECQUAAAAsAAAAACAAIAAAB/+AAIKDhIWGh4iJiouMjY6HIAKPjkFFP0CTjB8VXx+ZigI/FRAMkgACCWwdjwVCNIICRKMHkkJ3URlIj0FPITgABQ4VNUcFIDl4KiliposCLygtUyQAIXd0LQAzuClYDo9AKFIhN4ITmAV0GSkwX6uOIBziC4ZEKT4QQpmtr4YddStcfGoEYoI+RkIIEJiwaEIYNxpkLAIBDQWKfojy6NiYRIEiihYvKjrSo2QTEIsW3LjBUNEDD1SohBgIqlmjAi7eGaJA4VOBICheCCxEAhqmSSRCtowkCEfIno8eWHzxquiNVUJCDoVH4AY1AAQsHlUJpIDPQTfEDjJLc9AEiwcP2xYqQGKr3Lt48+rdizcQACH5BAkFAAAALAAAAAAgACAAAAf/gACCg4SFhoeIiYqLjI2Oj5CHCmkhCpGLU0gMMpeJBUOaPwWCAiwyHZAdlgACF0g5NgIALkcRTSWPEy8DQgAFdUh3uCBOVFBMELKMBTcoKC8UAC8/CC8AQ11NTBozj0DOKA+CJOIFEtp4FaiOIBzPLoZeTHge8JAFLtGGHVt1NJ2MQEzoxUgIAQITFj1og4EJm0UCBoD7l8iGHCtWlIBQFHGiIhtZQmpcZPBGQkUPxIhY8hDgoQIUlDnCt84QBX33grwzROIFCiCRSIA7CUIZDnA4Gz1w9uJfzxuohICzx47ADRKCCDgDCmDBDRyjIoUF0OznoLEuJzgj6LJQARJUCtvKnUu3rt25gQAAIfkECQUAAAAsAAAAACAAIAAAB/+AAIKDhIWGh4iJiouMjY6PkIgkC5GMHEMzN5WKLBcOQ4MCL2oKkCAgggWdJR8FADREbWMfjyQvA0KCaRdEFwACJUZcXQ2ujRwoKC8UAEB1FhwABrJdS76OOMkoD4I0JIJOY11UOaWOIMgvNIYXZOTrkAUuzIYKJ1vwm4oCD0FCxomEECAwYRGQGhpUJPmSz5CAAdoaGrpjpyKPKzISFYCYTGIhBGZCmrFjQJELAjcKKnqwIQoTJk4E6DNUoIPNR/I6IGIxRGe8IMpcGCKR4EsbobW0qQQhE0A2KQ5QQHqQTB0AWzd0CtGW6xEIlN8AEEgGRNCCGzgA4hx0g+wgtfoTJiTrOrNQARJI6+rdy7evX76BAAAh+QQJBQAAACwAAAAAIAAgAAAH/4AAgoOEhYaHiImKi4yNjo+QiCACkYxCTywklYoEaTIsgwUcQJEgBYM3aQYygh1vHiYtj0IvN0KCnVtTAAUrJhBrDo8cKCgvFABCLQYTAGoVwGJbjzjFKA+CCjSCDl9rRkgKjyDEL9uFWxtxNuePBS7IhiAsJ/GbigILQED2iEIEBJop4jCHShImYlAkEjDAWrtDOVKkwEIRwilEBBwquuOmY0cIilwQuCEwEQ4ISpRQmUPgnqECHWJeZPSuwyEQQ4bYhFQgiDEXhhxo0TIG6CMS1gROEpQGih4dMSA9KGYOAIlaNoUYwKOHCCQQIzUByIiCFIAFMiqUdIeqmFleLhQHTSh2K26hAiSM2t3Lt6/fv5sCAQAh+QQJBQAAACwAAAAAIAAgAAAH/4AAgoOEhYaHiImKi4yNjo+QiAWRjRQ3BAqUihwoKByEIJOQBaIABJ0vggoJRBeZjjQ3N0KCp1IDAAUyRzkHKI9BqBQAQgMoLgBSNgwNDZ+OOJ0oC4Igr3XMJl6ljCCcL8OFagd0Dh2RBS7hhSBPIeeaiwIkODjriC4EBBOLQAdjZLpAwJXoVCcaio4wicJQgwdFBlEgTJQng0WLDxNRIHCDn6IJHsiAAVPhWTxCBTp0eNUoHbxCAmLEeOmoQLAXyAoxsCLHSE5HJKR5BCFAUJgdWqywgfQAFUISL26cQ6IDqQNIIDiSqNUJCAAFDdyI8Thq0I2ugx4UPQlgQidabA4LFSDxM67du3jz6qUUCAAh+QQJBQAAACwAAAAAIAAgAAAH/4AAgoOEhYaHiImKi4yNjo+QkZKECkBAApOJQCgoD5mDBQWDBJwcggUDUwSQHTc3QoKkKEGCTzMODjSPOJwvHQBCAwMUAEErDkVVLo8TnCgLggIggiwWRUd1kCAcKC/EhVJVeRcKkQUu34UCNwPln4kFQg8Pv4oUBAQTixN5NW1iDVYlkoVCV6IfZLp0iRAhhyKCBhEVaUKR4h17BG7oU/TgjpiPOWi9o6TAXaNz9dRt2ZLSUYEg3ZYVysPjyoaIjUg42wgCEwAjVs7YMQDpQS9dJF7c+FXESlAv2jKSiMUJCAAFErBwMWVu0I2qgxZMe9cMBayRhAqQkIm2rdu3cATjNgoEACH5BAkFAAAALAAAAAAgACAAAAf/gACCg4SFhoeIiYqLjI2Oj5CRkoQKQDgCk4k4KCgPmYMFBYMEnByDJBwUkB03N0KCpChBgkAsBiGQE5wvHQBCAwOqJCEydWyYjg+cKAuCAiCCHMUzuI8CHCgvqoU4dR8J0JAFLtuGOEHhn4gFNCQkyIkUBAQTiwtEBx4mSECKsSg0FH3YsKaNQST+lgVM5GDMmDAObSiSd6OeIhJHvnyZYwOHukIKFKRjNK6XIQpvLph8VCBINheGjrjBMufVIxLLLIIIKIALDzQ+6Ch4pCxbQBIvvrABgIQHjytYTjwCQeAGCVgoPJApoOBLmadeIokSdAMFka0AaHjAomTAJ10XFIiA4nD1UwESC0Z+3Mu3r9+/kAIBACH5BAkFAAAALAAAAAAgACAAAAf/gACCg4SFhoeIiYqLjI2Oj5CRkoQCEwsFk4k4KCgLmYOYgwScHIMULpEdBDdCgqMoQYITLyg4kBOcLx0AQgMDFLycLS+QC5ydggIgsigtakCQBRwoL8CFQi1TKKGPBS7WhkKXn4unHdyIFAQEE4tCK0VONh+tia8oNIoxBw0VFR5bFN3Ll+jCl4MHYyhSd6OdIiFEJNy54wAVOUIgMnZzscuQixVsOnYLQs0iIRsZNDQw2YjEMYdPSinggkUFngMiGT3IlQ+ICjQBq/jAggGPl0cgVpEQ9ELFjjEFQHgYimGEgGiDWvjYQQaTEAg+Uvz49OKKjiKm2IT8ROFIlZwXCOPKnUu3LqRAACH5BAkFAAAALAAAAAAgACAAAAf/gACCg4SFhoeIiYqLjI2Oj5CRkoQFJCSTijgoKAuYiASbHIMdHZEKHARCgqAoQYITLy+Xjw+bL6VCAwMUAEKbrZALv50AAiCvv6qPBRwoL7yFvig4kgUu0IYUNJ6MChTHixQEBBOLHVMrHytSi6wo24ksVUVISD/wn7/4h1MM/gw2XCgSd6PcwDdIbBBhx62QAAUClrkoZYhGDBkKIhUI4kxgoR9NIiDYx4jEr3ICWrgCIUYDFCp5KDaq5WxbDjlYDABwIEJDEiorHoEgcOMSBRU64BgpAEJCzyQmCkCSCoAEjKRhpLrwICKKBU9tkv4YRMEARk8TjvyQ2bCt27dwBONGCgQAIfkECQUAAAAsAAAAACAAIAAAB/+AAIKDhIWGh4iJiouMjY6PkJGShAUkJJOKEygoC5iIBJscgyAgkQocBEKCoChBgg8vAzSQD5svHQBCAzcUuZsoOJALv50AAgKCmpuqjwUcKC+9hUKbwZEFLtKGFLOeiwIgBYwUBAQT3y9qCSzMiawo3Yg3dUMXFyeL7/GHUhb+FgYWUeBw45yiDgZmvIlxyVshAeKaucBliIYMNaUgFQgCzYUhL2PaVNHWiMSvcwKeAAEA4ksELnGqKHhUC9osBDxE4PtAJQKYODEegSBw4xIFPFbKbCgAIo8SnzkiOoooBEPSNuJo3KHS5Y2nEVZ4lBjUIc2UmZgm2HCA1qHbt3AF48qVFAgAIfkECQUAAAAsAAAAACAAIAAAB/+AAIKDhIWGh4iJiouMjY6PkJGShAUkQpOKDygoC5iIBJscgyAFkQocBJcAoChBgg8vNx2Qmigvs0IDNxQAQpsoD5ALv50AAgKCE7+qjgUctryFQi8oOJIFLtGGHTSejAWljBQEBBOLBUADA0DIiqwo3YkPTy1padbuv/GIQTL+Mq4UUeBww5wiEC1OnJACwpshcJCwzdrG4knDiEFQSAlh6AIEDx8mOnKx6cgcYyFQGDvQpgadDxcbaXqDxQsAJz7wGAAwJE6bEXMSPALxQgwDARSS2IFhwliVMD9/QBJQDAcWOz7aIKPgxEibGJgWqMCqVZCCjTEjUVBix80dh4UQLuChkgZuoQck7Ordy5dQIAAh+QQJBQAAACwAAAAAIAAgAAAH/4AAgoOEhYaHiImKi4yNjo+QkZKEBSQuk4oPKCgkmIgEmxyDAgWRChwEQoKgKEGCDwMEIJCaKC8dAEIDNxS5mygLkAu/wQCkghO/qo8FHLa9hUIvKDiSBS7Qhh00noyljRQEBBOLBUC71YusKNyJw7/Zn7/tiO+b8YcUHDfkigVBLwak60bwWhABhkCguIEQUrMiWH4YksHAxhYFkIQgMLMDgrE0L4w5qXDnCJuGjWZY6QFnBoAiGZQkAGBgDsk8LR6lyeAmj4AOS1LguWPMyxwPEthAIvFAEAkmKUR8KdXBgok7UjA9jVrjm4AbrjC5aJIigwmChTxEfYOW0IISbwgwtp1Lt66gQAAh+QQJBQAAACwAAAAAIAAgAAAH/4AAgoOEhYaHiImKi4yNjo+QkZKEBUIuk4oPKCgkmIgEmxyDBZIKHARCgqAoQYIPAxwCkJooLx0AQgM3FLibKKmPC74LggKkABO+vI8FHLXLhEIvKDiSBS7QhR00nozHjBQEBBOLBUC6xIurKNyJwpu26r7tiEK+8YoUHDfkigU4BDgA60YQSAkZsgoJCILjm6MJSXrIKWEohIMVaRI6qrJDB5w5AAQ8uSFoho0SH1pAMqEjS5kVAIg0GcMCgBoENoh8ePCohYYUTgR0GBNliRMABergJAIEkpB0QpZEoXKAFIgtPwyAwBQ1ipIK3255okHG6x2Che54rYOWEIkPdQi2tp1Lt66gQAAh+QQJBQAAACwAAAAAIAAgAAAH/4AAgoOEhYaHiImKi4yNjo+QkZKEBUIuk4oPKCgkmIgEmxyDBZIKHARCgqAoQYILN0ECkJooLx0AQgM3FLibKKmPC74LggKkABO+vI8FHLXLhEIvKDiSBS7QhR00nozHjBQEBBOLBUC6nYurKNyJwpsDsorr7YhCvvGLFBw35IoFOAhwqNetGw4HJ+QVInEp0gQlWXhYMHRDBosg3xodgSOnTAUABV60AnBixZYpIx15kGPGzRAAXrjUeAJAioUVbNSAePQECp4iAhSs6WKkBMgpXlac2PlICDEALsJ0iXOElIAXCaphchGnS5g8GbvREOPVRsFCR7waOBvtggGmbAbjyp0LIBAAIfkECQUAAAAsAAAAACAAIAAAB/+AAIKDhIWGh4iJiouMjY6PkJGShAVCLpOKDygoJJiIBJscgwWSChwEQoKgKEGCCzdApI+aKC8dAEIDNxS4myi8jwu+C4ICshO+wI4FHLXKg0IvKDiSBS7PhB00noyyjBQEBBOLBUC6qYurKNuJJL433ogDagkxnYlC7/GHLWFNJrcSFcBBIAi7RR2E7ONGCAeRISAOubgUKUgXM24cGKIV6xGJMGWu+JAAoAABagBQhJCC4sEjByHdqFgB4EINCQMABDmxksAjCXbcpMgjQIGJNSZopuQpypGUCFGK3KJRYw0djSWBAFEAycU4QTQgrJlDhCEhCnPWfLFglpADtWoN2g6iIIOFALl48+YNBAAh+QQJBQAAACwAAAAAIAAgAAAH/4AAgoOEhYaHiImKi4yNjo+QkZKEBUIuk4oPKCgkmIgEmxyDBZIKHARCgqAoQYILN0Ckj5ooLx0AQgM3FLibKLyPC74LggKyE77AjgUctcqDQi8oOJIFLs+EHTSejLKMuTcTiwVAupeKQmBKNRI3iiS+BIskKT09Ox/o8YwXTCk12AoVwEEgSMBDHVx442ZogoUYIA65OAcJyBgfKvIVgoci1iMhbXykEJEHADliAIAMe+QExkgodQBskVClFUcUohqB4JIiQxQHBUAwaODkhKAJ0h48YpBBg5OIFCQ0yBNTEAWKjSjIOKHA6p0GCIYwJAQiD9gtYwkZOOAkZ1qTHAeovZ1Ll24gACH5BAkFAAAALAAAAAAgACAAAAf/gACCg4SFhoeIiYqLjI2Oj5CRkoQFQi6Tig8oKCSYiASbHJ4ACkEEQoKgKEGCJARABZCaKC8dAEIDNxS3myi7jwu9C4ICsQATvb+OBRy0yoNCLyg4kgUuz4QdNJFCqI3GjCsYMGudiQVAuduKQhg772+KJL0EiyQZWVlwM+y9ootDmoiYg61QARwEghQ8pMAFuFGGHswwAOIQhYWLcLQRAeWCIRLSYD0SAgEPEypVWl0CAETYoyomlXAxAEDNjyHDhPQC4ghEGyZNuswoIIBIkRlSBD148cJbIydNIhCpSMNGkQ8sBnVQAKnDFDVcAXQoUsSLGoiEBHwoYgEFWkI4DS4kWPdW0MO6ePPWDQQAIfkECQUAAAAsAAAAACAAIAAAB/+AAIKDhIWGh4iJiouMjY6PkJGShAVCLpOKDygoJJiIBJscngAKQQRCgqAoQYIkBEAFkJooLx0AQgM3FLebKLuPC70LggKxABO9v44FHLTKg0IvKDiSBS7PhB00kS6ojcaMQyIYI52JBUADBNiGQnhWcHAXiiS9oopCUWZmZW/49oxidEnigR0lHASCGDSkgAa4UYYWXEgg4BCFhYomzFHChY0hEtKAQHJRgQqZOF4E0VAgCEgvb40cLCETZoQaAFJipNklpNcERyDm0FwTo4CAIUPUUAPw4MUAjIaIhGnzpmKHGUOm3CMFAlKHEC2MgbgwJMFWiIJYDDkxDO0gBTcKfrqdS7euXUOBAAAh+QQJBQAAACwAAAAAIAAgAAAH/4AAgoOEhYaHiImKi4yNjo+QkZKEBUIuk4oPKCgkmIgEmxyeAApBBEKCoChBgiQEQAWQMi0oLx0AQgM3FLibKLyPORC0C4ICsQATvsCOQFBfT8yDQi8oOJI4DsWHHTSPBS4kQgKNyIokXxoZIhuoiQVAAwS3iV52djw8ZQ7nvqKJM9wIFOhFkRBfrBKRoNMEypIGl97heKVgUSUSEUchIsEmBDlDFKQ5WnAgTo0EhkhUAwKJBoI4G+jUEaQAhCAgvtw1emNkwxwJTwAEeTLg1sFN2xgJkLDhS4UTAAqwoMUSwAN5FR3NcMqGnAA1tP4BOAZJgZQXyAqkoaqxEJAnLw1EtqWQta3du3jzKgoEACH5BAkFAAAALAAAAAAgACAAAAf/gACCg4SFhoeIiYqLjI2Oj5CRkoQFQi6Tig8oKCSYgx0FgwSbHJ4AaU0/QoKjKEGCJARAoY9zPSkGHQBCAzcUu5sov48SOz1GD4ICtBPBw444STtlT4ZCLyg4kjg/bLSFHTSPBTSWAo3fiSwbTUxJX52JBUADBLqIIEZY+zAwSIokgr3CtyGDQYMOFAkJBkRRiw1kyIxhEA9RARyyQCwCIUSIOFOJXCR4km4QhWePSDiZc6eFIRLYGj6iUIXOgTwJBIHQCABHsI+N2Jg4gODHDQAwB+hauGnBIyIHGCBxCaCVzAX1eDZSk6eImlAFbmwaCKBASUYTkonapA0kIV4EDRS4LWR2rt27ePMeCgQAIfkECQUAAAAsAAAAACAAIAAAB/+AAIKDhIWGh4iJiouMjY6PkJGShAVCLpOKDygoJJiDFEKDBJscngAtTSlFgqMoQYIkBEAFkB5ZOlYGAEIDNxS7myi/jwxwWjsSggK0ABPBw444VHBnF4ZCLyg4khMlW8yFHTSPBTRCNOCK6Yhpc2RLER6hiQVAAwQdiSA1UVEaGniIKCIR7BUiAXSaKFQ4Q5GQYEAUSTHRps0IG/MQFcAhC8QiEC5cQDN1iEaaG+sEURjpyIWFPD9uGCKRLeIjEG+OVPmAQhAIjwBwBBvnCIWTKl5iPABAc0C+h5s6Fa1i4cIAVptsLrgHtJGCE2xkAihwY5PBsSkZCSDEYdMCkoUOKHDg0BWu3bt48+pdFAgAIfkECQUAAAAsAAAAACAAIAAAB/+AAIKDhIWGh4iJiouMjY6PkJGShAVCLpOKDygoJJiDNEKDBJscngAtUBlVgqMoQYIkBEAFkAdmVmUyAEIDNxS7myi/j0c8Z1Y5ggK0ABPBw44TZDx2dYZCLyg4khNeMsyFHTSPBRQuNOCK6YhSB2JhcTnjiQVAAwQKiQIVXV0RS0suKCIRDIi+O2MSJhyiSEhBRQMYmDDRwME8RAVwyAKxSAAFGh1MKerwwuAhCtAeUYjhhc0DQySymXx04kOdKdsAgOAIAMezRyRW1DnxZFzMASEdbrrkyAUbGWleAmhlcsGNIAIg2esEoMCNTa8ErZsUZNMCkYUUBJkwFq3bt3AF48pFFAgAIfkECQUAAAAsAAAAACAAIAAAB/+AAIKDhIWGh4iJiouMjY6PkJGShA8XLpOECxOEX01SJJgAU0l4JYIUKkpSHKEVblduRAAUGWQoQYIkBEAFj04wbnZoBgBObTcUAEIozMmOD2EwaDwVghO9ABPMKM6ON9E+FoZCLyg4kg8fFwKHHTSQ7hTYi/OJL0dzEBBO74kFQAMIKEgkIM+aNm3EGGGjiMQ2IP6QfJk4kViiZcwgJuJQBQECJxe6HSqAYxeIRQI6UBgYSpECHEIQURDpCESIBE8uFSJRTuOjF1OeoNgEAMRJADi20XQZQuiLdzwHdFC2TWejAgNQvAAFgEBGQQtu4KjHSMECqzeY4RJEdhIQZgsPWhoSMOGa3Lt48+rdiykQACH5BAkFAAAALAAAAAAgACAAAAf/gACCg4SFhoeIiYqLjI2Oj5CRkoQLRTMKk4JCFyGEdDs6R5kCBxgiFoIUeDs9Jpk0XBkpKg4AFBqsRIIkBEAFjwwaGVgYMgA2PFgoAEIozhSPExsaKjASggQPghPOKNCPHCMaIjOGQi8oOJIkKzEChx00kAoUHb+M94pCFjkSEiXfEBUAMoAApkRDGlTw4MFEAkUkugFRFIOBRYss9ElU5IKNAwcfTnRQVABHLxCMFChAmWmRABcjD1EI+KgABxQvXBgigW4iJG7OJggCwRJHN5qMCDh7IY/ngJHNnkECgpMENmc+F9xQB6mAi4MAbjgLMihfS6MorLY0JOCB2rVwB+PKnUtXbiAAOwAAAAAAAAAAAA==' alt='Loading' /><span>Loading...</span></div>"),a(".pv-loading").css("top",a(".pv-wrapper").height()/2-33+"px"),a(".pv-loading").css("left",a(".pv-wrapper").width()/2-43+"px")},InitTileCollection=function(){InitUI();var d=C.ImageBase;d.indexOf("http",0)>=0||d.indexOf("www.",0)>=0||(d=C.CollectionBase.substring(0,C.CollectionBase.lastIndexOf("/")+1)+d);var e=a(".pv-viewarea-canvas")[0].getContext("2d");c=new PivotViewer.Views.SimpleImageController;var f=C.GetUniqueImages();b=new PivotViewer.Views.TileController(c),o=b.initTiles(C.Items,d,e),c.Setup(d.replace("\\","/"),f)},InitPivotViewer=function(){CreateFacetList(),CreateViews(),AttachEventHandlers(),a(".pv-loading").remove(),ApplyViewerState(),s=GetItem(z.Selection),u=z.TableFacet,ResizeView.Breadcrumb(),null!=z.View?(0!=z.View&&1!=z.View&&(SelectView(0,!0),v=!1),SelectView(z.View,!0)):SelectView(0,!0);var c=s&&s.Id?s.Id:"";b.BeginAnimation(!0,c)},InitUI=function(){var b="<div class='pv-toolbarpanel'>",c=C.BrandImage;c.length>0&&(b+="<img class='pv-toolbarpanel-brandimage' src='"+c+"'></img>"),b+="<span class='pv-toolbarpanel-name'>"+C.CollectionName+"</span>",b+="<div class='pv-toolbarpanel-facetbreadcrumb'></div>",b+="<div class='pv-toolbarpanel-zoomcontrols'><div class='pv-toolbarpanel-zoomslider'></div>",b+="<div class='pv-toolbarpanel-maplegend'></div></div>",b+="<div class='pv-toolbarpanel-viewcontrols'></div>",b+="<div class='pv-toolbarpanel-sortcontrols'></div>",b+="</div>",A.append(b);var d=0;a(".pv-toolbarpanel-zoomslider").slider({max:100,change:function(b,c){var e=c.value-d;centreX=a(".pv-viewarea-canvas").width()/2,centreY=a(".pv-viewarea-canvas").height()/2,a.publish("/PivotViewer/Views/Canvas/Zoom",[{x:centreX,y:centreY,delta:.5*e}]),d=c.value}}),A.append("<div class='pv-mainpanel'></div>"),a(".pv-mainpanel").append("<div class='pv-filterpanel'></div>"),a(".pv-mainpanel").append("<div class='pv-viewpanel'><canvas class='pv-viewarea-canvas'></canvas></div>"),a(".pv-mainpanel").append("<div class='pv-infopanel'></div>"),a(".pv-viewpanel").append("<div class='pv-mapview-canvas' id='pv-map-canvas'></div>");var e=a(".pv-filterpanel");e.append("<div class='pv-filterpanel-clearall'>Clear All</div>").append("<input class='pv-filterpanel-search' type='text' placeholder='Search...' /><div class='pv-filterpanel-search-autocomplete'></div>"),a(".pv-filterpanel-search-autocomplete").hide();var f=a(".pv-infopanel");f.append("<div class='pv-infopanel-controls'></div>"),a(".pv-infopanel-controls").append("<div><div class='pv-infopanel-controls-navleft'></div><div class='pv-infopanel-controls-navleftdisabled'></div><div class='pv-infopanel-controls-navbar'></div><div class='pv-infopanel-controls-navright'></div><div class='pv-infopanel-controls-navrightdisabled'></div></div>"),a(".pv-infopanel-controls-navleftdisabled").hide(),a(".pv-infopanel-controls-navrightdisabled").hide(),f.append("<div class='pv-infopanel-heading'></div>"),
f.append("<div class='pv-infopanel-details'></div>");var g=a("<div class='pv-infopanel-footer'></div>");C.MaxRelatedLinks>0&&g.append("<div class='pv-infopanel-related'></div>"),""!=C.CopyrightName&&g.append("<div class='pv-infopanel-copyright'><a href=\""+C.CopyrightHref+'" target="_blank">'+C.CopyrightName+"</a></div>"),f.append(g),f.hide(),ResizeView()},CreateFacetList=function(){for(var b=0;b<C.Items.length;b++)for(var c=C.Items[b],d=0;d<C.FacetCategories.length;d++){for(var h=C.FacetCategories[d],i=!1,j=0,k=c.Facets.length;j<k;j++){var l=c.Facets[j];if(l.Name==h.Name){for(var m=0;m<l.FacetValues.length;m++)if(h.Type==PivotViewer.Models.FacetType.String||h.Type==PivotViewer.Models.FacetType.Link){for(var n=!1,o="pv-facet-item-"+CleanName(l.Name)+"__"+CleanName(l.FacetValues[m].Value),p=e.length-1;p>-1;p-=1)if(e[p].itemId==o){e[p].count+=1,n=!0;break}n||e.push({itemId:o,itemValue:l.FacetValues[m].Value,facet:l.Name,count:1})}else if(h.Type==PivotViewer.Models.FacetType.Number){for(var q=!1,p=0;p<f.length;p++)if(f[p].Facet==c.Facets[j].Name){f[p].Values.push(l.FacetValues[m].Value),q=!0;break}q||f.push({Facet:l.Name,Values:[l.FacetValues[m].Value]})}i=!0}}if(!i){for(var n=!1,o="pv-facet-item-"+CleanName(h.Name)+"__"+CleanName("(no info)"),p=e.length-1;p>-1;p-=1)if(e[p].itemId==o){e[p].count+=1,n=!0;break}n||e.push({itemId:o,itemValue:"(no info)",facet:h.Name,count:1})}if(h.IsWordWheelVisible)for(var j=0,k=c.Facets.length;j<k;j++){var l=c.Facets[j];if(l.Name==h.Name)for(var m=0;m<l.FacetValues.length;m++)h.Type==PivotViewer.Models.FacetType.String&&g.push({Facet:l.Name,Value:l.FacetValues[m].Value})}}CreateDatetimeBuckets();for(var r=["<div class='pv-filterpanel-accordion'>"],s=[],t=0,b=0;b<C.FacetCategories.length;b++){var u="inherit";C.FacetCategories[b].IsFilterVisible||(u="none"),b==t&&"none"==u&&t++,r[b+1]="<h3 style='display:"+u+"'><a href='#' title="+C.FacetCategories[b].Name+">",r[b+1]+=C.FacetCategories[b].Name,r[b+1]+="</a><div class='pv-filterpanel-accordion-heading-clear' facetType='"+C.FacetCategories[b].Type+"'>&nbsp;</div></h3>",r[b+1]+="<div id='pv-cat-"+CleanName(C.FacetCategories[b].Name)+"'>",C.FacetCategories[b].Type==PivotViewer.Models.FacetType.DateTime?(C.FacetCategories[b].decadeBuckets.length>1?(r[b+1]+=CreateBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].decadeBuckets,C.FacetCategories[b].yearBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].monthBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].dayBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].hourBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].minuteBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].secondBuckets)):C.FacetCategories[b].yearBuckets.length>1?(r[b+1]+=CreateBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].yearBuckets,C.FacetCategories[b].monthBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].decadeBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].dayBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].hourBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].minuteBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].secondBuckets)):C.FacetCategories[b].monthBuckets.length>1?(r[b+1]+=CreateBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].monthBuckets,C.FacetCategories[b].dayBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].decadeBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].yearBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].hourBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].minuteBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].secondBuckets)):C.FacetCategories[b].dayBuckets.length>1?(r[b+1]+=CreateBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].dayBuckets,C.FacetCategories[b].hourBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].decadeBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].yearBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].monthBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].minuteBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].secondBuckets)):C.FacetCategories[b].hourBuckets.length>1?(r[b+1]+=CreateBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].hourBuckets,C.FacetCategories[b].minuteBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].decadeBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].yearBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].monthBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].dayBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].secondBuckets)):C.FacetCategories[b].minuteBuckets.length>1?(r[b+1]+=CreateBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].minuteBuckets,C.FacetCategories[b].secondBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].decadeBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].yearBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].monthBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].dayBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].hourBuckets)):C.FacetCategories[b].secondBuckets.length>1&&(r[b+1]+=CreateBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].secondBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].decadeBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].yearBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].monthBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].dayBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].hourBuckets),r[b+1]+=CreateHiddenBucketizedDateTimeFacets(C.FacetCategories[b].Name,C.FacetCategories[b].minuteBuckets)),r[b+1]+=CreateDatetimeNoInfoFacet(C.FacetCategories[b].Name),r[b+1]+=CreateCustomRange(C.FacetCategories[b].Name)):C.FacetCategories[b].Type==PivotViewer.Models.FacetType.String||C.FacetCategories[b].Type==PivotViewer.Models.FacetType.Link?(void 0!=C.FacetCategories[b].CustomSort||null!=C.FacetCategories[b].CustomSort?r[b+1]+="<span class='pv-filterpanel-accordion-facet-sort' customSort='"+C.FacetCategories[b].CustomSort.Name+"'>Sort: "+C.FacetCategories[b].CustomSort.Name+"</span>":r[b+1]+="<span class='pv-filterpanel-accordion-facet-sort'>Sort: A-Z</span>",r[b+1]+=CreateStringFacet(C.FacetCategories[b].Name)):C.FacetCategories[b].Type==PivotViewer.Models.FacetType.Number&&(r[b+1]+="<div id='pv-filterpanel-category-numberitem-"+CleanName(C.FacetCategories[b].Name)+"'></div>"),r[b+1]+="</div>",s[b]="<option value='"+CleanName(C.FacetCategories[b].Name)+"' label='"+C.FacetCategories[b].Name+"'>"+C.FacetCategories[b].Name+"</option>"}r[r.length]="</div>",a(".pv-filterpanel").append(r.join(""));for(var b=0;b<C.FacetCategories.length;b++)C.FacetCategories[b].IsFilterVisible&&SortFacetItems(C.FacetCategories[b].Name);a(".pv-filterpanel-accordion").accordion({heightStyle:"content",collapsible:!0}),a(".pv-toolbarpanel-sortcontrols").append('<select class="pv-toolbarpanel-sort">'+s.join("")+"</select>");for(var b=0;b<f.length;b++)CreateNumberFacet(CleanName(f[b].Facet),f[b].Values)},CreateBucketizedDateTimeFacets=function(a,b,c){var d=["<ul class='pv-filterpanel-accordion-facet-list'>"];if(b)for(var e=0;e<b.length;e++){var f=e+1;d[f]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-item-"+CleanName(a)+"__"+CleanName(b[e].Name.toString())+"'>",d[f]+="<input itemvalue='"+CleanName(b[e].Name.toString())+"' itemfacet='"+CleanName(a.toString())+"' class='pv-facet-facetitem' type='checkbox' />",d[f]+="<span class='pv-facet-facetitem-label' title='"+b[e].Name+"'>"+b[e].Name+"</span>",d[f]+="<span class='pv-facet-facetitem-count'>0</span>",d[f]+="</li>"}if(d[b.length+1]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-item-LineBreak' style='border-bottom:thin solid #E2E2E2;'></li>",d[b.length+2]="</ul>",d[b.length+3]="<ul class='pv-filterpanel-accordion-facet-list'>",c)for(var e=0;e<c.length;e++){var f=e+4+b.length;d[f]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-item-"+CleanName(a)+"__"+CleanName(c[e].Name.toString())+"'>",d[f]+="<input itemvalue='"+CleanName(c[e].Name.toString())+"' itemfacet='"+CleanName(a.toString())+"' class='pv-facet-facetitem' type='checkbox' />",d[f]+="<span class='pv-facet-facetitem-label' title='"+c[e].Name+"'>"+c[e].Name+"</span>",d[f]+="<span class='pv-facet-facetitem-count'>0</span>",d[f]+="</li>"}return d[b.length+c.length+4]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-item-LineBreak2' style='border-bottom:thin solid #E2E2E2;'></li>",d[b.length+c.length+5]="</ul>",d.join("")},CreateHiddenBucketizedDateTimeFacets=function(a,b){var c=["<ul class='pv-filterpanel-accordion-facet-list' style='visibility:hidden;display:none'>"];if(b){for(var d=0;d<b.length;d++){var e=d+1;c[e]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-item-"+CleanName(a)+"__"+CleanName(b[d].Name.toString())+"' style='visibility:hidden'>",c[e]+="<input itemvalue='"+CleanName(b[d].Name.toString())+"' itemfacet='"+CleanName(a.toString())+"' class='pv-facet-facetitem' type='checkbox' />",c[e]+="<span class='pv-facet-facetitem-label' title='"+b[d].Name+"'>"+b[d].Name+"</span>",c[e]+="<span class='pv-facet-facetitem-count'>0</span>",c[e]+="</li>"}c[c.length]="<li class='pv-filterpanel-accordion-facet-list-item'  style='border-bottom:thin solid #E2E2E2;' style='visibility:hidden'></li>",c[c.length]="</ul>"}return c.join("")},CreateCustomRange=function(a){var b=["<ul class='pv-filterpanel-accordion-facet-list'>"];return b[1]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-item-"+CleanName(a)+"___CustomRange'>",b[1]+="<input itemvalue='CustomRange' itemfacet='"+CleanName(a)+"' class='pv-facet-facetitem' type='checkbox' />",b[1]+="<span class='pv-facet-facetitem-label' title='Custom Range'>Custom Range</span>",b[1]+="</li>",b[1]+="<ul class='pv-filterpanel-accordion-facet-list'>",b[1]+="<li class='pv-filterpanel-accordion-facet-list-item' id='pv-custom-range-"+CleanName(a)+"__Start' style='visibility:hidden;float:right'>",b[1]+="<span class='pv-facet-customrange-label' title='Start Date' >Start:</span>",b[1]+="<input itemvalue='CustomRangeStart' itemfacet='"+CleanName(a)+"' id='pv-custom-range-"+CleanName(a)+"__StartDate' class='pv-facet-customrange' type='text'/>",b[1]+="</li>",b[1]+="<li class='pv-filterpanel-accordion-facet-list-item' id='pv-custom-range-"+CleanName(a)+"__Finish' style='visibility:hidden;float:right'>",b[1]+="<span class='pv-facet-customrange-label' title='End Date'>End:</span>",b[1]+="<input itemvalue='CustomRangeFinish' itemfacet='"+CleanName(a)+"' id='pv-custom-range-"+CleanName(a)+"__FinishDate' class='pv-facet-customrange' type='text'/>",b[1]+="</li>",b[b.length]="</ul>",b.join("")},CreateDatetimeNoInfoFacet=function(a){for(var b=["<ul class='pv-filterpanel-accordion-facet-list'>"],c=0;c<e.length;c++)e[c].facet==a&&"(no info)"==e[c].itemValue&&(b[1]="<li class='pv-filterpanel-accordion-facet-list-item'  id='"+e[c].itemId+"'>",b[1]+="<input itemvalue='"+CleanName(e[c].itemValue)+"' itemfacet='"+CleanName(a)+"' class='pv-facet-facetitem' type='checkbox' />",b[1]+="<span class='pv-facet-facetitem-label' title='"+e[c].itemValue+"'>"+e[c].itemValue+"</span>",b[1]+="<span class='pv-facet-facetitem-count'>0</span>",b[1]+="</li>");return b[b.length]="<li class='pv-filterpanel-accordion-facet-list-item'  style='border-bottom:thin solid #E2E2E2;'></li>",b[b.length]="</ul>",b.join("")},CreateStringFacet=function(a){for(var b=["<ul class='pv-filterpanel-accordion-facet-list'>"],c=0;c<e.length;c++)e[c].facet==a&&(b[c+1]="<li class='pv-filterpanel-accordion-facet-list-item'  id='"+e[c].itemId+"'>",b[c+1]+="<input itemvalue='"+CleanName(e[c].itemValue)+"' itemfacet='"+CleanName(a)+"' class='pv-facet-facetitem' type='checkbox' />",b[c+1]+="<span class='pv-facet-facetitem-label' title='"+e[c].itemValue+"'>"+e[c].itemValue+"</span>",b[c+1]+="<span class='pv-facet-facetitem-count'>0</span>",b[c+1]+="</li>");return b[b.length]="</ul>",b.join("")},CreateNumberFacet=function(b,c){for(var d=165,e=80,f="n0",g=0;g<C.FacetCategories.length;g++)if(CleanName(C.FacetCategories[g].Name)==b){f=C.FacetCategories[g].Format;break}var h=a("#pv-filterpanel-category-numberitem-"+PivotViewer.Utils.EscapeMetaChars(b));h.empty(),h.append("<span class='pv-filterpanel-numericslider-range-val'>&nbsp;</span>");for(var i="<svg class='pv-filterpanel-accordion-facet-chart' width='"+d+"' height='"+e+"'>",j=PivotViewer.Utils.Histogram(c),k=.5+d/j.BinCount|0,l=0,m=0,n=j.Histogram.length;m<n;m++)l=l<j.Histogram[m].length?j.Histogram[m].length:l;for(var m=0,n=j.Histogram.length;m<n;m++){var o=.5+e/(l/j.Histogram[m].length)|0,p=.5+k*m|0;i+="<rect x='"+p+"' y='"+(e-o)+"' width='"+k+"' height='"+o+"'></rect>"}h.append(i+"</svg>");var q=a("#pv-filterpanel-category-numberitem-"+PivotViewer.Utils.EscapeMetaChars(b));q.append('</span><div id="pv-filterpanel-numericslider-'+b+'" class="pv-filterpanel-numericslider"></div><span class="pv-filterpanel-numericslider-range-min">'+j.Min.formatNumber(f)+'</span><span class="pv-filterpanel-numericslider-range-max">'+j.Max.formatNumber(f)+"</span>");var r=a("#pv-filterpanel-numericslider-"+PivotViewer.Utils.EscapeMetaChars(b));r.slider({range:!0,format:f,min:j.Min,step:(j.Max-j.Min)/100,max:j.Max,values:[j.Min,j.Max],slide:function(b,c){a(this).parent().find(".pv-filterpanel-numericslider-range-val").text(c.values[0].formatNumber(f)+" - "+c.values[1].formatNumber(f))},stop:function(b,c){var d=a(this),e=d.slider("option","min"),f=d.slider("option","max");c.values[0]>e||c.values[1]<f?d.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible"):c.values[0]==e&&c.values[1]==f&&d.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","hidden"),FilterCollection(!1)}})},CreateViews=function(){var c=a(".pv-viewpanel");d.push(new PivotViewer.Views.GridView),d.push(new PivotViewer.Views.GraphView);for(var e=0;e<d.length;e++)try{if(d[e]instanceof PivotViewer.Views.IPivotViewerView)d[e].Setup(D,b.GetMaxTileRatio()),c.append("<div class='pv-viewpanel-view' id='pv-viewpanel-view-"+e+"'>"+d[e].GetUI()+"</div>"),a(".pv-toolbarpanel-viewcontrols").append("<div class='pv-toolbarpanel-view' id='pv-toolbarpanel-view-"+e+"' title='"+d[e].GetViewName()+"'><img id='pv-viewpanel-view-"+e+"-image' src='"+d[e].GetButtonImage()+"' alt='"+d[e].GetViewName()+"' /></div>");else{var f="";f+="View does not inherit from PivotViewer.Views.IPivotViewerView<br>",a(".pv-wrapper").append('<div id="pv-view-error" class="pv-modal-dialog"><div><a href="#pv-modal-dialog-close" title="Close" class="pv-modal-dialog-close">X</a><h2>HTML5 PivotViewer</h2><p>'+f+"</p></div></div>"),window.open("#pv-view-error","_self")}}catch(a){console.log(a.Message)}ResizeView.Breadcrumb(),d[1].SetFacetCategories(C)},SelectView=function(b,c){for(var e=0;e<d.length;e++)b!=e&&(a("#pv-viewpanel-view-"+e+"-image").attr("src",d[e].GetButtonImage()),d[e].Deactivate(),d[e].init=!1);a("#pv-viewpanel-view-"+b+"-image").attr("src",d[b].GetButtonImageSelected()),1!=n||2!=b&&3!=b&&4!=b||(d[0].Activate(),d[0].init=c,n=0,FilterCollection(!0)),d[b].Activate(),d[b].init=c,n=b,1==b&&(a.publish("/PivotViewer/Views/Item/Selected",[{id:"",bkt:0}]),q=""),FilterCollection(!0)},SortFacetItems=function(b){if(C.GetFacetCategoryByName(b).Type!=PivotViewer.Models.FacetType.DateTime){var c=a("#pv-cat-"+PivotViewer.Utils.EscapeMetaChars(CleanName(b))+" ul"),d=c.prev().text().replace("Sort: ",""),e=c.children("li").get();if("A-Z"==d)e.sort(function(b,c){var d=a(b).children().first().attr("itemvalue"),e=a(c).children().first().attr("itemvalue");return d<e?1:d>e?-1:0});else if("Quantity"==d)e.sort(function(b,c){var d=parseInt(a(b).children(".pv-facet-facetitem-count").text()),e=parseInt(a(c).children(".pv-facet-facetitem-count").text());return d<e?-1:d>e?1:0});else{var f=C.GetFacetCategoryByName(b);if(void 0!=f.CustomSort){for(var g=[],h=f.CustomSort.SortValues.length-1;h>-1;h-=1)for(var i=0;i<e.length;i++)f.CustomSort.SortValues[h]==a(e[i]).children(".pv-facet-facetitem-label").text()&&(g.push(e[i]),found=!0);e=g}}for(var h=0;h<e.length;h++)c.prepend(e[h])}},ApplyViewerState=function(){null!=z.Facet&&(a(".pv-toolbarpanel-sort option[value="+CleanName(z.Facet)+"]").prop("selected","selected"),w=a(".pv-toolbarpanel-sort :selected").attr("label"),Debug.Log("current sort "+w));for(var b=0,c=z.Filters.length;b<c;b++)for(var d=!1,e=0,f=z.Filters[b].Predicates.length;e<f;e++){var g=z.Filters[b].Predicates[e].Operator;if("GT"==g||"GE"==g||"LT"==g||"LE"==g){var h=a("#pv-filterpanel-numericslider-"+CleanName(z.Filters[b].Facet));if(h.length>0){var i=parseFloat(z.Filters[b].Predicates[e].Value);switch(g){case"GT":h.slider("values",0,i+1);break;case"GE":h.slider("values",0,i);break;case"LT":h.slider("values",1,i-1);break;case"LE":h.slider("values",1,i)}h.parent().find(".pv-filterpanel-numericslider-range-val").text(h.slider("values",0)+" - "+h.slider("values",1)),h.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible")}else{var j=CleanName(z.Filters[b].Facet),k=a("#pv-facet-item-"+j+"___CustomRange")[0].firstElementChild;switch(k.checked=!0,d||(GetCustomDateRange(j),d=!0),g){case"GE":a("#pv-custom-range-"+j+"__StartDate")[0].value=new Date(z.Filters[b].Predicates[e].Value),CustomRangeChanged(a("#pv-custom-range-"+j+"__StartDate")[0]);break;case"LE":a("#pv-custom-range-"+j+"__FinishDate")[0].value=new Date(z.Filters[b].Predicates[e].Value),CustomRangeChanged(a("#pv-custom-range-"+j+"__FinishDate")[0])}}}else"EQ"==g?SelectStringFacetItem(CleanName(z.Filters[b].Facet),CleanName(z.Filters[b].Predicates[e].Value)):"NT"==g&&SelectStringFacetItem(CleanName(z.Filters[b].Facet),"_no_info_")}},SelectStringFacetItem=function(b,c){var d=a('.pv-facet-facetitem[itemfacet="'+b+'"][itemvalue="'+c+'"]');d.prop("checked",!0),d.parent().parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible")},FilterCollection=function(c){var e=[],f=[],g=a(".pv-toolbarpanel-sort option:selected").attr("label");Debug.Log("sort "+g),c||(q="");var i=a(".pv-facet-facetitem:checked");a(".pv-filterpanel-clearall").css("visibility","hidden");for(var j=[],r=[],t=0;t<i.length;t++){var w=B[a(i[t]).attr("itemfacet")],x=B[a(i[t]).attr("itemvalue")],y=C.GetFacetCategoryByName(w);if(y.Type==PivotViewer.Models.FacetType.String){for(var z=!1,A=0;A<j.length;A++)j[A].facet==w&&(j[A].facetValue.push(x),z=!0);z||j.push({facet:w,facetValue:[x]}),a.inArray(w,f)<0&&f.push(w)}else if(y.Type==PivotViewer.Models.FacetType.DateTime){var D=a("#pv-custom-range-"+CleanName(w)+"__StartDate")[0].value,E=a("#pv-custom-range-"+CleanName(w)+"__FinishDate")[0].value;if(D&&E)r.push({facet:w,facetValue:[x],minDate:new Date(D),maxDate:new Date(E)});else{for(var z=!1,A=0;A<r.length;A++)r[A].facet==w&&(r[A].facetValue.push(x),z=!0);z||r.push({facet:w,facetValue:[x]})}a.inArray(w,f)<0&&f.push(w)}}for(var F=[],t=0,G=C.FacetCategories.length;t<G;t++)if(C.FacetCategories[t].Type==PivotViewer.Models.FacetType.Number){var H=a("#pv-filterpanel-category-numberitem-"+CleanName(C.FacetCategories[t].Name)),I=a(H).find(".pv-filterpanel-numericslider");if(I.length>0){var J=I.slider("values"),K=I.slider("option","max"),L=I.slider("option","min");if(J[0]!=L||J[1]!=K){var w=C.FacetCategories[t].Name;F.push({facet:w,selectedMin:J[0],selectedMax:J[1],rangeMin:L,rangeMax:K}),a.inArray(w,f)<0&&f.push(w)}}}for(var t=0,G=C.Items.length;t<G;t++){for(var M=0,N=0,O=j.length;N<O;N++)for(var P=0,Q=j[N].facetValue.length;P<Q;P++)if("(no info)"==j[N].facetValue[P]){for(var R=!1,A=0,S=C.Items[t].Facets.length;A<S;A++)C.Items[t].Facets[A].Name==j[N].facet&&(R=!0);0==R&&M++}for(var A=0,S=C.Items[t].Facets.length;A<S;A++)for(var N=0,O=j.length;N<O;N++){var T=0;if(C.Items[t].Facets[A].Name==j[N].facet)for(var U=0,V=C.Items[t].Facets[A].FacetValues.length;U<V;U++)for(var P=0,Q=j[N].facetValue.length;P<Q;P++)C.Items[t].Facets[A].FacetValues[U].Value==j[N].facetValue[P]&&T++;T>0&&M++}if(M==j.length){for(var N=0,O=F.length;N<O;N++)if("(no info)"==F[N].selectedMin){for(var R=!1,A=0,S=C.Items[t].Facets.length;A<S;A++)C.Items[t].Facets[A].Name==F[N].facet&&(R=!0);0==R&&M++}for(var A=0,S=C.Items[t].Facets.length;A<S;A++)for(var N=0,O=F.length;N<O;N++)if(C.Items[t].Facets[A].Name==F[N].facet)for(var U=0,V=C.Items[t].Facets[A].FacetValues.length;U<V;U++){var W=parseFloat(C.Items[t].Facets[A].FacetValues[U].Value);!isNaN(W)&&W>=F[N].selectedMin&&W<=F[N].selectedMax&&M++}if(M==j.length+F.length){for(var N=0,O=r.length;N<O;N++)for(var P=0,Q=r[N].facetValue.length;P<Q;P++)if("(no info)"==r[N].facetValue[P]){for(var R=!1,A=0,S=C.Items[t].Facets.length;A<S;A++)C.Items[t].Facets[A].Name==r[N].facet&&(R=!0);0==R&&M++}for(var A=0,S=C.Items[t].Facets.length;A<S;A++)for(var N=0,O=r.length;N<O;N++){var T=0;if(C.Items[t].Facets[A].Name==r[N].facet)if(r[N].minDate&&r[N].maxDate){var X=new Date(C.Items[t].Facets[A].FacetValues[0].Value);X<=r[N].maxDate&&X>=r[N].minDate&&T++}else{for(var y=C.GetFacetCategoryByName(r[N].facet),P=0,Q=r[N].facetValue.length;P<Q;P++)for(l=0;l<y.decadeBuckets.length;l++)if(y.decadeBuckets[l].Name==r[N].facetValue[P])for(var U=0;U<y.decadeBuckets[l].Items.length;U++)y.decadeBuckets[l].Items[U]==C.Items[t].Id&&T++;for(var P=0,Q=r[N].facetValue.length;P<Q;P++)for(l=0;l<y.yearBuckets.length;l++)if(y.yearBuckets[l].Name==r[N].facetValue[P])for(var U=0;U<y.yearBuckets[l].Items.length;U++)y.yearBuckets[l].Items[U]==C.Items[t].Id&&T++;for(var P=0,Q=r[N].facetValue.length;P<Q;P++)for(l=0;l<y.monthBuckets.length;l++)if(y.monthBuckets[l].Name==r[N].facetValue[P])for(var U=0;U<y.monthBuckets[l].Items.length;U++)y.monthBuckets[l].Items[U]==C.Items[t].Id&&T++;for(var P=0,Q=r[N].facetValue.length;P<Q;P++)for(l=0;l<y.dayBuckets.length;l++)if(y.dayBuckets[l].Name==r[N].facetValue[P])for(var U=0;U<y.dayBuckets[l].Items.length;U++)y.dayBuckets[l].Items[U]==C.Items[t].Id&&T++;for(var P=0,Q=r[N].facetValue.length;P<Q;P++)for(l=0;l<y.hourBuckets.length;l++)if(y.hourBuckets[l].Name==r[N].facetValue[P])for(var U=0;U<y.hourBuckets[l].Items.length;U++)y.hourBuckets[l].Items[U]==C.Items[t].Id&&T++;for(var P=0,Q=r[N].facetValue.length;P<Q;P++)for(l=0;l<y.minuteBuckets.length;l++)if(y.minuteBuckets[l].Name==r[N].facetValue[P])for(var U=0;U<y.minuteBuckets[l].Items.length;U++)y.minuteBuckets[l].Items[U]==C.Items[t].Id&&T++;for(var P=0,Q=r[N].facetValue.length;P<Q;P++)for(l=0;l<y.secondBuckets.length;l++)if(y.secondBuckets[l].Name==r[N].facetValue[P])for(var U=0;U<y.secondBuckets[l].Items.length;U++)y.secondBuckets[l].Items[U]==C.Items[t].Id&&T++}T>0&&M++}M==j.length+F.length+r.length&&(e.push(C.Items[t].Id),j.length+F.length+r.length>0&&a(".pv-filterpanel-clearall").css("visibility","visible"))}}}k=F,h=j,m=r,a(".pv-viewpanel-view").hide(),a("#pv-viewpanel-view-"+n).show(),FilterFacets(e,f),UpdateBreadcrumbNavigation(j,F,r),b.SetCircularEasingBoth(),v?(d[n].Filter(o,e,g,j,c,q),2!=n&&3!=n||c||d[0].Filter(o,e,g,j,!1,"")):(2==n?(d[n].SetSelectedFacet(u),d[n].Filter(o,e,g,j,c,s)):d[n].Filter(o,e,g,j,c,q),v=!0);var Y=[];if("Graph View"==d[n].GetViewName())Y=d[n].GetSortedFilter();else for(var t=0;t<d[n].tiles.length;t++){var Z=a.inArray(d[n].tiles[t].facetItem.Id,e);if(Z>=0){var $=new Object;$.Id=d[n].tiles[t].facetItem.Id,$.Bucket=0,Y.push($)}}p=Y,UpdateBookmark(),DeselectInfoPanel()},BucketCounts=function(b,c,d){for(var e=0;e<b.length;e++){for(var f=a("#pv-facet-item-"+CleanName(c)+"__"+CleanName(b[e].Name.toString())),g=0,h=0;h<d.length;h++)b[e].Items.indexOf(d[h])!=-1&&g++;f.find("span").last().text(g),0==g?f.hide():f.show()}},GetDateTimeItemCounts=function(b,c){if(b.decadeBuckets.length>0)for(var d=0;d<b.decadeBuckets.length;d++){var e=a("#pv-facet-item-"+CleanName(b.Name)+"__"+CleanName(b.decadeBuckets[d].Name.toString()));e.find("span").last().text(b.decadeBuckets[d].Items.length),e.show()}if(b.yearBuckets.length>0)for(var d=0;d<b.yearBuckets.length;d++){var e=a("#pv-facet-item-"+CleanName(b.Name)+"__"+CleanName(b.yearBuckets[d].Name.toString()));e.find("span").last().text(b.yearBuckets[d].Items.length),e.show()}if(b.monthBuckets.length>0)for(var d=0;d<b.monthBuckets.length;d++){var e=a("#pv-facet-item-"+CleanName(b.Name)+"__"+CleanName(b.monthBuckets[d].Name.toString()));e.find("span").last().text(b.monthBuckets[d].Items.length),e.show()}if(b.dayBuckets.length>0)for(var d=0;d<b.dayBuckets.length;d++){var e=a("#pv-facet-item-"+CleanName(b.Name)+"__"+CleanName(b.dayBuckets[d].Name.toString()));e.find("span").last().text(b.dayBuckets[d].Items.length),e.show()}if(b.hourBuckets.length>0)for(var d=0;d<b.hourBuckets.length;d++){var e=a("#pv-facet-item-"+CleanName(b.Name)+"__"+CleanName(b.hourBuckets[d].Name.toString()));e.find("span").last().text(b.hourBuckets[d].Items.length),e.show()}if(b.minuteBuckets.length>0)for(var d=0;d<b.minuteBuckets.length;d++){var e=a("#pv-facet-item-"+CleanName(b.Name)+"__"+CleanName(b.minuteBuckets[d].Name.toString()));e.find("span").last().text(b.minuteBuckets[d].Items.length),e.show()}if(b.secondBuckets.length>0)for(var d=0;d<b.secondBuckets.length;d++){var e=a("#pv-facet-item-"+CleanName(b.Name)+"__"+CleanName(b.secondBuckets[d].Name.toString()));e.find("span").last().text(b.secondBuckets[d].Items.length),e.show()}},FilterFacets=function(b,c){if(b.length!=C.Items.length){for(var d=[],g=[],h=b.length-1;h>-1;h-=1)for(var i=C.GetItemById(b[h]),j=0;j<C.FacetCategories.length;j++)if(C.FacetCategories[j].IsFilterVisible){for(var k=!1,l=i.Facets.length-1;l>-1;l-=1)if(i.Facets[l].Name==C.FacetCategories[j].Name){if(a.inArray(i.Facets[l].Name,c)<0){var m=C.GetFacetCategoryByName(i.Facets[l].Name);if(m.IsFilterVisible)for(var n=i.Facets[l].FacetValues.length-1;n>-1;n-=1)if(m.Type==PivotViewer.Models.FacetType.String){for(var o={item:"#"+PivotViewer.Utils.EscapeMetaChars("pv-facet-item-"+CleanName(i.Facets[l].Name)+"__"+CleanName(i.Facets[l].FacetValues[n].Value)),count:1},p=!1,q=d.length-1;q>-1;q-=1)if(d[q].item==o.item){d[q].count+=1,p=!0;break}p||d.push(o)}else if(m.Type==PivotViewer.Models.FacetType.Number){for(var r=!1,q=0;q<g.length;q++)if(g[q].Facet==i.Facets[l].Name){g[q].Values.push(i.Facets[l].FacetValues[n].Value),r=!0;break}r||g.push({Facet:i.Facets[l].Name,Values:[i.Facets[l].FacetValues[n].Value]})}}k=!0}if(!k){for(var o={item:"#"+PivotViewer.Utils.EscapeMetaChars("pv-facet-item-"+CleanName(C.FacetCategories[j].Name)+"__"+CleanName("(no info)")),count:1},p=!1,q=d.length-1;q>-1;q-=1)if(d[q].item==o.item){d[q].count+=1,p=!0;break}p||d.push(o)}}for(var h=e.length-1;h>-1;h-=1)if(a.inArray(e[h].facet,c)<0){for(var p=!1,l=d.length-1;l>-1;l-=1)if(d[l].item==e[h].itemId){p=!0;break}p||a("#"+PivotViewer.Utils.EscapeMetaChars(e[h].itemId)).hide()}else a("#"+PivotViewer.Utils.EscapeMetaChars(e[h].itemId)).find("span").last().text(e[h].count);for(var h=d.length-1;h>-1;h-=1){var s=a(d[h].item);if(s.length>0){s.show();var t=s.find("span").last();t.text(d[h].count)}}for(var h=0;h<g.length;h++)CreateNumberFacet(CleanName(g[h].Facet),g[h].Values);for(var h=0;h<C.FacetCategories.length;h++)if(a.inArray(C.FacetCategories[h].Name,c)<0&&C.FacetCategories[h].Type==PivotViewer.Models.FacetType.DateTime){var u=C.FacetCategories[h];u.decadeBuckets.length>0&&"hidden"!=a("#pv-facet-item-"+CleanName(u.Name)+"__"+CleanName(u.decadeBuckets[0].Name.toString())).css("visibility")&&BucketCounts(u.decadeBuckets,u.Name,b),u.yearBuckets.length>0&&"hidden"!=a("#pv-facet-item-"+CleanName(u.Name)+"__"+CleanName(u.yearBuckets[0].Name.toString())).css("visibility")&&BucketCounts(u.yearBuckets,u.Name,b),u.monthBuckets.length>0&&"hidden"!=a("#pv-facet-item-"+CleanName(u.Name)+"__"+CleanName(u.monthBuckets[0].Name.toString())).css("visibility")&&BucketCounts(u.monthBuckets,u.Name,b),u.dayBuckets.length>0&&"hidden"!=a("#pv-facet-item-"+CleanName(u.Name)+"__"+CleanName(u.dayBuckets[0].Name.toString())).css("visibility")&&BucketCounts(u.dayBuckets,u.Name,b),u.hourBuckets.length>0&&"hidden"!=a("#pv-facet-item-"+CleanName(u.Name)+"__"+CleanName(u.hourBuckets[0].Name.toString())).css("visibility")&&BucketCounts(u.hourBuckets,u.Name,b),u.minuteBuckets.length>0&&"hidden"!=a("#pv-facet-item-"+CleanName(u.Name)+"__"+CleanName(u.minuteBuckets[0].Name.toString())).css("visibility")&&BucketCounts(u.minuteBuckets,u.Name,b),u.secondBuckets.length>0&&"hidden"!=a("#pv-facet-item-"+CleanName(u.Name)+"__"+CleanName(u.secondBuckets[0].Name.toString())).css("visibility")&&BucketCounts(u.secondBuckets,u.Name,b)}}else{for(var h=0;h<C.FacetCategories.length;h++)C.FacetCategories[h].Type==PivotViewer.Models.FacetType.DateTime&&GetDateTimeItemCounts(C.FacetCategories[h],b);for(var h=e.length-1;h>-1;h-=1){var i=a("#"+PivotViewer.Utils.EscapeMetaChars(e[h].itemId));i.show(),i.find("span").last().text(e[h].count)}for(var h=0;h<f.length;h++)CreateNumberFacet(CleanName(f[h].Facet),f[h].Values)}},UpdateBreadcrumbNavigation=function(b,c,d){var e=a(".pv-toolbarpanel-facetbreadcrumb");if(e.empty(),0!=b.length||0!=c.length||0!=d.length){for(var f="|",g=0,h=b.length;g<h;g++)f+="<span class='pv-toolbarpanel-facetbreadcrumb-facet'>"+b[g].facet+":</span><span class='pv-toolbarpanel-facetbreadcrumb-values'>",f+=b[g].facetValue.join(", "),f+="</span><span class='pv-toolbarpanel-facetbreadcrumb-separator'>&gt;</span>";for(var g=0,h=c.length;g<h;g++){f+="<span class='pv-toolbarpanel-facetbreadcrumb-facet'>"+c[g].facet+":</span><span class='pv-toolbarpanel-facetbreadcrumb-values'>";for(var i="n0",j=0;j<C.FacetCategories.length;j++)if(C.FacetCategories[j].Name==c[g].facet){i=C.FacetCategories[j].Format;break}f+=c[g].selectedMin==c[g].rangeMin?"Under "+c[g].selectedMax.formatNumber(i):c[g].selectedMax==c[g].rangeMax?"Over "+c[g].selectedMin.formatNumber(i):c[g].selectedMin.formatNumber(i)+" - "+c[g].selectedMax.formatNumber(i),f+="</span><span class='pv-toolbarpanel-facetbreadcrumb-separator'>&gt;</span>"}for(var g=0,h=d.length;g<h;g++)d[g].maxDate&&d[g].minDate?(f+="<span class='pv-toolbarpanel-facetbreadcrumb-facet'>"+d[g].facet+":</span><span class='pv-toolbarpanel-facetbreadcrumb-values'>",f+="Between "+d[g].minDate+" and "+d[g].maxDate,f+="</span><span class='pv-toolbarpanel-facetbreadcrumb-separator'>&gt;</span>"):(f+="<span class='pv-toolbarpanel-facetbreadcrumb-facet'>"+d[g].facet+":</span><span class='pv-toolbarpanel-facetbreadcrumb-values'>",f+=d[g].facetValue.join(", "),f+="</span><span class='pv-toolbarpanel-facetbreadcrumb-separator'>&gt;</span>");
e.append(f)}},DeselectInfoPanel=function(){a(".pv-infopanel").fadeOut(),a(".pv-infopanel-heading").empty(),a(".pv-infopanel-details").empty()},GetItemIds=function(a,b){for(var c=[],d=0;d<C.Items.length;d++){for(var e=!1,f=0;f<C.Items[d].Facets.length;f++)if(C.Items[d].Facets[f].Name==a){for(var g=0;g<C.Items[d].Facets[f].FacetValues.length;g++)b==C.Items[d].Facets[f].FacetValues[g].Value&&c.push(C.Items[d].Id);e=!0}e||"(no info)"!=b||c.push(C.Items[d].Id)}return c},GetItem=function(a){for(var b=0;b<C.Items.length;b++)if(C.Items[b].Id==a)return C.Items[b];return null},UpdateBookmark=function(){var a="#",b=n+1;a+="$view$="+b,w&&(a+="&$facet0$="+w),q&&(a+="&$selection$="+q.Id),2==n&&d[n].GetSelectedFacet()&&(a+="&$tableFacet$="+d[n].GetSelectedFacet());var c=C.CollectionName;if(k.length+h.length>0&&(c+=" | "),h.length>0)for(i=0;i<h.length;i++){for(j=0;j<h[i].facetValue.length;j++)a+="&",a+=h[i].facet,a+="=EQ."+h[i].facetValue[j];c+=h[i].facet+": ",c+=h[i].facetValue.join(", "),i<h.length-1&&(c+=" > ")}if(k.length>0)for(i=0;i<k.length;i++)a+="&",a+=k[i].facet,c+=k[i].facet+": ",k[i].selectedMin==k[i].rangeMin?(a+="=LE."+k[i].selectedMax,c+="Under "+k[i].selectedMax):k[i].selectedMax==k[i].rangeMax?(a+="=GE."+k[i].selectedMin,c+="Over "+k[i].selectedMin):(a+="=GE."+k[i].selectedMin+"_LE."+k[i].selectedMax,c+="Between "+k[i].selectedMin+" and "+k[i].selectedMax),i<k.length-1&&(c+=" > ");if(m.length>0)for(i=0;i<m.length;i++){for(j=0;j<m[i].facetValue.length;j++)a+="&",a+=m[i].facet,c+=m[i].facet+": ",m[i].maxDate&&m[i].minDate?(a+="=GE."+m[i].minDate+"_LE."+m[i].maxDate,c+="Between "+m[i].minDate+" and "+m[i].maxDate):(a+="=EQ."+m[i].facetValue[j],c+=m[i].facetValue.join(", "));i<m.length-1&&(c+=" > ")}void 0!=typeof SetBookmark&&"function"==typeof SetBookmark&&SetBookmark(C.CollectionBaseNoProxy,a,c)},CleanName=function(a){return name=a.replace(/[^\w]/gi,"_"),B[name]=a,name},a.subscribe("/PivotViewer/Models/Collection/Loaded",function(a){InitTileCollection()}),a.subscribe("/PivotViewer/ImageController/Collection/Loaded",function(b){InitPivotViewer();a(".pv-filterpanel")}),a.subscribe("/PivotViewer/Views/Item/Selected",function(b){if(void 0===b.id||null===b.id||""===b.id)return DeselectInfoPanel(),q="",2==n&&d[n].Selected(q.Id),void UpdateBookmark();var c=GetItem(b.id);if(null!=c){var e=!0;a(".pv-infopanel-heading").empty(),a(".pv-infopanel-heading").append('<a href="'+c.Href+'" target="_blank">'+c.Name+"</a></div>");var f=a(".pv-infopanel-details");f.empty(),void 0!=c.Description&&c.Description.length>0&&f.append("<div class='pv-infopanel-detail-description' style='height:100px;'>"+c.Description+"</div><div class='pv-infopanel-detail-description-more'>More</div>"),c.Id==p[0].Id&&c.Id==p[p.length-1].Id?(a(".pv-infopanel-controls-navright").hide(),a(".pv-infopanel-controls-navrightdisabled").show(),a(".pv-infopanel-controls-navleft").hide(),a(".pv-infopanel-controls-navleftdisabled").show()):c.Id==p[0].Id?(a(".pv-infopanel-controls-navleft").hide(),a(".pv-infopanel-controls-navleftdisabled").show(),a(".pv-infopanel-controls-navright").show(),a(".pv-infopanel-controls-navrightdisabled").hide()):c.Id==p[p.length-1].Id?(a(".pv-infopanel-controls-navright").hide(),a(".pv-infopanel-controls-navrightdisabled").show(),a(".pv-infopanel-controls-navleft").show(),a(".pv-infopanel-controls-navleftdisabled").hide()):(a(".pv-infopanel-controls-navright").show(),a(".pv-infopanel-controls-navrightdisabled").hide(),a(".pv-infopanel-controls-navleft").show(),a(".pv-infopanel-controls-navleftdisabled").hide());for(var g=[],h=0,i=0;i<c.Facets.length;i++){for(var j=!1,k=!1,l="String",m="",o=0;o<C.FacetCategories.length;o++)if(C.FacetCategories[o].Name==c.Facets[i].Name&&C.FacetCategories[o].IsMetaDataVisible){j=!0,k=C.FacetCategories[o].IsFilterVisible,l=C.FacetCategories[o].Type,m=C.FacetCategories[o].Format;break}if(j){g[h]="<div class='pv-infopanel-detail "+(e?"detail-dark":"detail-light")+"'><div class='pv-infopanel-detail-item detail-item-title' pv-detail-item-title='"+c.Facets[i].Name+"'>"+c.Facets[i].Name+"</div>";for(var o=0;o<c.Facets[i].FacetValues.length;o++)g[h]+="<div pv-detail-item-value='"+c.Facets[i].FacetValues[o].Value+"' class='pv-infopanel-detail-item detail-item-value"+(!k||"String"!=l&&"Link"!=l?"":" detail-item-value-filter")+"'>","Link"==l?g[h]+="<a class='detail-item-link' target='_blank' href='"+c.Facets[i].FacetValues[o].Value+"'>"+c.Facets[i].FacetValues[o].Value+"</a>":"Number"==l?g[h]+=c.Facets[i].FacetValues[o].Value.formatNumber(m):g[h]+=c.Facets[i].FacetValues[o].Value,g[h]+="</div>";g[h]+="</div>",h++,e=!e}}if(c.Links.length>0){a(".pv-infopanel-related").empty();for(var s=0;s<c.Links.length;s++)a(".pv-infopanel-related").append("<a href='"+c.Links[s].Href+"'>"+c.Links[s].Name+"</a>")}return f.append(g.join("")),a(".pv-infopanel").fadeIn(),ResizeView.InfoPanel(),q=c,r=b.bkt,2==n&&d[n].Selected(q.Id),3==n&&d[n].RedrawMarkers(q.Id),void UpdateBookmark()}}),a.subscribe("/PivotViewer/Views/Item/Filtered",function(b){if(void 0!=b&&null!=b){if(console.log("FILTERED"),1==b.ClearFacetFilters)for(var c=0,d=C.FacetCategories.length;c<d;c++)if(C.FacetCategories[c].Name==b.Facet&&(C.FacetCategories[c].Type==PivotViewer.Models.FacetType.String||C.FacetCategories[c].Type==PivotViewer.Models.FacetType.DateTime))for(var e=a('.pv-facet-facetitem[itemfacet="'+CleanName(b.Facet.toString())+'"]'),f=0;f<e.length;f++)a(e[f]).prop("checked",!1);for(var c=0,d=C.FacetCategories.length;c<d;c++){if(C.FacetCategories[c].Name==b.Facet&&(C.FacetCategories[c].Type==PivotViewer.Models.FacetType.String||C.FacetCategories[c].Type==PivotViewer.Models.FacetType.DateTime))if(b.Values)for(var f=0;f<b.Values.length;f++){var g=a(PivotViewer.Utils.EscapeMetaChars("#pv-facet-item-"+CleanName(b.Facet.toString())+"__"+CleanName(b.Values[f].toString()))+" input");g.prop("checked",!0),FacetItemClick(g[0])}else{var g=a(PivotViewer.Utils.EscapeMetaChars("#pv-facet-item-"+CleanName(b.Facet.toString())+"__"+CleanName(b.Item.toString()))+" input");g.prop("checked",!0),FacetItemClick(g[0])}if(C.FacetCategories[c].Name==b.Facet&&C.FacetCategories[c].Type==PivotViewer.Models.FacetType.Number){var h=a("#pv-filterpanel-numericslider-"+PivotViewer.Utils.EscapeMetaChars(CleanName(b.Facet)));FacetSliderDrag(h,b.Item,b.MaxRange)}}}}),a.subscribe("/PivotViewer/Views/Item/Updated",function(){UpdateBookmark()}),a.subscribe("/PivotViewer/Views/ChangeTo/Grid",function(b){var c="";for(t=0;t<o.length;t++)if(o[t].facetItem==b.Item){c=o[t];break}c&&a.publish("/PivotViewer/Views/Canvas/Click",[{x:c._locations[c.selectedLoc].destinationx+c.destinationwidth/2,y:c._locations[c.selectedLoc].destinationy+c.destinationheight/2}])}),a.subscribe("/PivotViewer/Views/Update/GridSelection",function(a){d[0].handleSelection(a.selectedItem,a.selectedTile)}),AttachEventHandlers=function(){a(".pv-toolbarpanel-view").on("click",function(a){var b=this.id.substring(this.id.lastIndexOf("-")+1,this.id.length);null!=b&&SelectView(parseInt(b),!1)}),a(".pv-toolbarpanel-sort").on("change",function(b){w=a(".pv-toolbarpanel-sort option:selected").attr("label"),Debug.Log("sort change _currentSort "+w),FilterCollection(!1)}),a(".pv-filterpanel-accordion-facet-sort").on("click",function(b){var c=a(this),d=c.text(),e=c.parent().prev().children("a").text(),f=c.attr("customSort");"Sort: A-Z"==d?a(this).text("Sort: Quantity"):"Sort: Quantity"==d&&void 0==f?a(this).text("Sort: A-Z"):"Sort: Quantity"==d?a(this).text("Sort: "+f):a(this).text("Sort: A-Z"),SortFacetItems(e)}),a(".pv-facet-facetitem").on("click",function(a){FacetItemClick(this)}),a(".pv-facet-facetitem-label").on("click",function(b){var c=a(this).prev(),d=a(this.parentElement.parentElement).find(":checked");1==c.prop("checked")&&d.length<=1?c.prop("checked",!1):c.prop("checked",!0);for(var e=d.length-1;e>-1;e-=1)d[e].getAttribute("itemvalue")!=c[0].getAttribute("itemvalue")&&(d[e].checked=!1);FacetItemClick(c[0])}),a(".pv-filterpanel-clearall").on("click",function(b){for(var c=a(".pv-facet-facetitem:checked"),d=0;d<c.length;d++)a(c[d]).prop("checked",!1),"CustomRange"==a(c[d]).attr("itemvalue")&&HideCustomDateRange(a(c[d]).attr("itemfacet"));for(var e=a(".pv-filterpanel-numericslider"),d=0;d<e.length;d++){var f=a(e[d]),g=f.slider("option","min"),h=f.slider("option","max");f.slider("values",0,g),f.slider("values",1,h),f.prev().prev().html("&nbsp;")}a(".pv-filterpanel-search").val(""),a(".pv-filterpanel-accordion-heading-clear").css("visibility","hidden"),FilterCollection(!1)}),a(".pv-filterpanel-accordion-heading-clear").on("click",function(b){var c=this.attributes.facetType.value;if("DateTime"==c)for(var d=a(this.parentElement).next().find(".pv-facet-facetitem:checked"),e=0;e<d.length;e++)a(d[e]).prop("checked",!1),HideCustomDateRange(a(d[e]).attr("itemfacet"));else if("String"==c)for(var d=a(this.parentElement).next().find(".pv-facet-facetitem:checked"),e=0;e<d.length;e++)a(d[e]).prop("checked",!1);else if("Number"==c){var f=a(this.parentElement).next().find(".pv-filterpanel-numericslider"),g=f.slider("option","min"),h=f.slider("option","max");f.slider("values",0,g),f.slider("values",1,h),f.prev().prev().html("&nbsp;")}FilterCollection(!1),a(this).css("visibility","hidden")}),a(".ui-slider-range").on("mousedown",function(a){}),a(".pv-facet-customrange").on("change",function(a){CustomRangeChanged(this)}),a(".pv-infopanel-details").on("click",".detail-item-value-filter",function(b){return a.publish("/PivotViewer/Views/Item/Filtered",[{Facet:a(this).parent().children().attr("pv-detail-item-title"),Item:this.getAttribute("pv-detail-item-value"),Values:null,ClearFacetFilters:!0}]),!1}),a(".pv-infopanel-details").on("click",".pv-infopanel-detail-description-more",function(b){var c=a(this),d=a(this).prev();"Less"==c.text()?(d.css("height","100px"),a(this).text("More")):(d.css("height",""),a(this).text("Less"))}),a(".pv-infopanel-controls-navleft").on("click",function(b){for(var c=0;c<p.length;c++)if(p[c].Id==q.Id&&p[c].Bucket==r){if(c>=0&&a.publish("/PivotViewer/Views/Item/Selected",[{id:p[c-1].Id,bkt:p[c-1].Bucket}]),0==n||1==n)for(var e=0;e<o.length;e++)o[e].facetItem.Id==p[c-1].Id?(o[e].Selected(!0),selectedCol=d[n].GetSelectedCol(o[e],p[c-1].Bucket),selectedRow=d[n].GetSelectedRow(o[e],p[c-1].Bucket),d[n].CentreOnSelectedTile(selectedCol,selectedRow)):o[e].Selected(!1);break}}),a(".pv-infopanel-controls-navright").on("click",function(b){for(var c=0;c<p.length;c++)if(p[c].Id==q.Id&&p[c].Bucket==r){if(c<p.length&&(a.publish("/PivotViewer/Views/Item/Selected",[{id:p[c+1].Id,bkt:p[c+1].Bucket}]),0==n||1==n))for(var e=0;e<o.length;e++)o[e].facetItem.Id==p[c+1].Id?(o[e].Selected(!0),selectedCol=d[n].GetSelectedCol(o[e],p[c+1].Bucket),selectedRow=d[n].GetSelectedRow(o[e],p[c+1].Bucket),d[n].CentreOnSelectedTile(selectedCol,selectedRow)):o[e].Selected(!1);break}}),a(".pv-filterpanel-search").on("keyup",function(b){var c=!1,d=[],e=a(".pv-filterpanel-search-autocomplete"),f=FilterCollection,h=SelectStringFacetItem;if(e.empty(),27==b.keyCode)return void a(b.target).blur();for(var i=0,j=g.length;i<j;i++){var k=g[i].Value.toLowerCase();k.indexOf(b.target.value.toLowerCase())>=0&&a.inArray(k,d)==-1&&(d.push(k),e.append('<span facet="'+g[i].Facet+'">'+g[i].Value+"</span>"),13==b.keyCode&&(SelectStringFacetItem(CleanName(g[i].Facet),CleanName(g[i].Value)),c=!0))}a(".pv-filterpanel-search-autocomplete > span").on("mousedown",function(b){b.preventDefault(),a(".pv-filterpanel-search").val(b.target.textContent),a(".pv-filterpanel-search-autocomplete").hide(),h(CleanName(b.target.attributes[0].value),CleanName(b.target.textContent)),f()}),d.length>0&&e.show(),c&&FilterCollection(!1)}),a(".pv-filterpanel-search").on("blur",function(b){b.target.value="",a(".pv-filterpanel-search-autocomplete").hide()});var c=a(".pv-viewarea-canvas");c.on("mouseup",function(b){var c=a(this).offset(),d=b.clientX-c.left,e=b.clientY-c.top;(!y||0==y.x&&0==y.y)&&a.publish("/PivotViewer/Views/Canvas/Click",[{x:d,y:e}]),x=null,y=!1}),c.on("mouseout",function(a){x=null,y=!1}),c.on("mousedown",function(b){var c=a(this).offset(),d=b.clientX-c.left,e=b.clientY-c.top;x={x:d,y:e}}),c.on("mousemove",function(b){var c=a(this).offset(),d=b.clientX-c.left,e=b.clientY-c.top;null==x?a.publish("/PivotViewer/Views/Canvas/Hover",[{x:d,y:e}]):(y={x:d-x.x,y:e-x.y},x={x:d,y:e},a.publish("/PivotViewer/Views/Canvas/Drag",[y]))}),c.on("mousewheel",function(c,d){var e=a(this).offset(),f=c.clientX-e.left,g=c.clientY-e.top;b.SetQuarticEasingOut(),b.DrawHelpers([{x:f,y:g}]);var h=a(".pv-toolbarpanel-zoomslider").slider("option","value");d>0?h=h<5?5:h+5:d<0&&(h-=5),h=Math.max(0,Math.min(100,h)),a(".pv-toolbarpanel-zoomslider").slider("option","value",h)}),c.on("touchstart",function(b){var c=b.originalEvent,d=a(this).offset(),e=c.touches[0].pageX-d.left,f=c.touches[0].pageY-d.top;x={x:e,y:f}}),c.on("touchmove",function(c){try{var d=c.originalEvent;if(c.preventDefault(),d.touches.length>1){c.preventDefault();for(var e=1e7,f=1e7,g=0,h=0,i=[],j=0;j<d.touches.length;j++)i.push({x:d.touches[j].pageX,y:d.touches[j].pageY}),d.touches[j].pageX<e&&(e=d.touches[j].pageX),d.touches[j].pageX>g&&(g=d.touches[j].pageX),d.touches[j].pageY<f&&(f=d.touches[j].pageY),d.touches[j].pageY>h&&(h=d.touches[j].pageY);var k=(e+g)/2,l=(f+h)/2;return b.SetLinearEasingBoth(),i.push({x:k,y:l}),b.DrawHelpers(i),b.DrawHelperText("Scale: "+d.scale),void a.publish("/PivotViewer/Views/Canvas/Zoom",[{x:k,y:l,scale:d.scale}])}var m=a(this).offset(),n=d.touches[0].pageX-m.left,o=d.touches[0].pageY-m.top;y={x:n-x.x,y:o-x.y},x={x:n,y:o},a.publish("/PivotViewer/Views/Canvas/Drag",[y])}catch(a){Debug.Log(a.message)}}),c.on("touchend",function(b){var c=b.originalEvent;if(1==c.touches.length&&null==x){var d=a(this).offset(),e=c.touches[0].pageX-d.left,f=c.touches[0].pageY-d.top;(!y||0==y.x&&0==y.y)&&a.publish("/PivotViewer/Views/Canvas/Click",[{x:e,y:f}])}x=null,y=!1})},FacetItemClick=function(b){if(1==a(b).prop("checked")){if(a(b.parentElement.parentElement.parentElement).prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible"),"CustomRange"==a(b).attr("itemvalue"))return void GetCustomDateRange(a(b).attr("itemfacet"))}else 0==a(b).prop("checked")&&"CustomRange"==a(b).attr("itemvalue")&&HideCustomDateRange(a(b).attr("itemfacet"));FilterCollection(!1)},FacetSliderDrag=function(b,c,d){var e=a(b),f=e.slider("option","min"),g=e.slider("option","max"),h=e.slider("option","format");"(no info)"==c&&(c=0),c>f||d<g?(e.parent().find(".pv-filterpanel-numericslider-range-val").text(c.formatNumber(h)+" - "+d.formatNumber(h)),e.slider("values",0,c),e.slider("values",1,d),e.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible")):c==f&&d==g&&e.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","hidden"),FilterCollection(!1)},Bucketize=function(a,b,c,d){var e=!1;if(0==b.length){var f=new PivotViewer.Models.DateTimeInfo(a,d);b[0]=f,b[0].Items.push(c)}else{for(var g=0;g<b.length;g++)b[g].Name==a&&(b[g].Items.push(c),e=!0);if(!e){var f=new PivotViewer.Models.DateTimeInfo(a,d);f.Items.push(c),b.push(f)}}},CreateDatetimeBuckets=function(){var a=new Array(12);a[0]="January",a[1]="February",a[2]="March",a[3]="April",a[4]="May",a[5]="June",a[6]="July",a[7]="August",a[8]="September",a[9]="October",a[10]="November",a[11]="December";for(var b=0;b<C.FacetCategories.length;b++){var c=C.FacetCategories[b];if(c.Type==PivotViewer.Models.FacetType.DateTime)for(var d=0;d<C.Items.length;d++)for(var e,f=C.Items[d],g=0;g<f.Facets.length;g++)if(f.Facets[g].Name==c.Name){e=f.Facets[g].FacetValues[0];var h=new Date(e.Value),i=h.getFullYear();Bucketize(i,c.yearBuckets,f.Id,new Date(i,0,0));var j=i-i%10;Bucketize(j+"s",c.decadeBuckets,f.Id,new Date(i,0,0));var k=h.getMonth();Bucketize(a[k]+", "+i,c.monthBuckets,f.Id,new Date(i,k,0));var l=h.getDate();Bucketize(a[k]+" "+l+", "+i,c.dayBuckets,f.Id,new Date(i,k,l));var m=h.getHours(),n=m>12?m-12+" pm":m+" am";Bucketize(a[k]+" "+l+", "+i+" "+n,c.hourBuckets,f.Id,new Date(i,k,l,m,0,0));var o=h.getMinutes();Bucketize(a[k]+" "+l+", "+i+" "+m+":"+o,c.minuteBuckets,f.Id,new Date(i,k,l,m,o,0));var p=h.getSeconds();Bucketize(a[k]+" "+l+", "+i+" "+m+":"+o+":"+p,c.secondBuckets,f.Id,new Date(i,k,l,m,o,p));break}c.decadeBuckets.sort(function(a,b){return a.StartDate-b.StartDate}),c.yearBuckets.sort(function(a,b){return a.StartDate-b.StartDate}),c.monthBuckets.sort(function(a,b){return a.StartDate-b.StartDate}),c.dayBuckets.sort(function(a,b){return a.StartDate-b.StartDate}),c.hourBuckets.sort(function(a,b){return a.StartDate-b.StartDate}),c.minuteBuckets.sort(function(a,b){return a.StartDate-b.StartDate}),c.secondBuckets.sort(function(a,b){return a.StartDate-b.StartDate})}},HideCustomDateRange=function(b){a("#pv-custom-range-"+b+"__Start").css("visibility","hidden"),a("#pv-custom-range-"+b+"__Finish").css("visibility","hidden"),a("#pv-custom-range-"+b+"__StartDate").datepicker("setDate",null),a("#pv-custom-range-"+b+"__FinishDate").datepicker("setDate",null),a("#pv-custom-range-"+b+"__FinishDate").datepicker("option","minDate",null),a("#pv-custom-range-"+b+"__StartDate").datepicker("option","minDate",null),a("#pv-custom-range-"+b+"__FinishDate").datepicker("option","maxDate",null),a("#pv-custom-range-"+b+"__StartDate").datepicker("option","maxDate",null)},GetCustomDateRange=function(b){var c,d,e,f,g=B[b],h=C.GetFacetCategoryByName(g);a("#pv-custom-range-"+b+"__Start").css("visibility","visible"),a("#pv-custom-range-"+b+"__Finish").css("visibility","visible"),a("#pv-custom-range-"+b+"__StartDate").datepicker({showOn:"button",changeMonth:!0,changeYear:!0,buttonText:"Show Date",buttonImageOnly:!0,buttonImage:"http://jqueryui.com/resources/demos/datepicker/images/calendar.gif"}),a("#pv-custom-range-"+b+"__FinishDate").datepicker({showOn:"button",changeMonth:!0,changeYear:!0,buttonText:"Show Date",buttonImageOnly:!0,buttonImage:"http://jqueryui.com/resources/demos/datepicker/images/calendar.gif"}),h.dayBuckets.length>0&&(e=h.dayBuckets[h.dayBuckets.length-1].StartDate,f=h.dayBuckets[0].StartDate,a("#pv-custom-range-"+b+"__StartDate").datepicker("option","defaultDate",f),a("#pv-custom-range-"+b+"__FinishDate").datepicker("option","defaultDate",e),h.yearBuckets.length>0&&(c=h.yearBuckets[h.yearBuckets.length-1].Name,d=h.yearBuckets[0].Name,a("#pv-custom-range-"+b+"__StartDate").datepicker("option","yearRange",d+":"+c),a("#pv-custom-range-"+b+"__FinishDate").datepicker("option","yearRange",d+":"+c)))},CustomRangeChanged=function(b){var c,d;if("CustomRangeStart"==a(b).attr("itemvalue")?(c=a(b)[0].value,d=a("#pv-custom-range-"+a(b).attr("itemfacet")+"__FinishDate")[0].value,""==d&&a("#pv-custom-range-"+a(b).attr("itemfacet")+"__FinishDate").datepicker("option","minDate",new Date(c))):"CustomRangeFinish"==a(b).attr("itemvalue")&&(d=a(b)[0].value,c=a("#pv-custom-range-"+a(b).attr("itemfacet")+"__StartDate")[0].value,""==c&&a("#pv-custom-range-"+a(b).attr("itemfacet")+"__StartDate").datepicker("option","maxDate",new Date(d))),c&&d){for(var e=a(b.parentElement.parentElement.parentElement.parentElement.children).next().find(".pv-facet-facetitem:checked"),f=0;f<e.length;f++)"CustomRange"!=a(e[f]).attr("itemvalue")&&a(e[f]).prop("checked",!1);FilterCollection(!1)}},a.fn.PivotViewer=function(b){return E[b]?E[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.PivotViewer"):E.init.apply(this,arguments)}}(jQuery);